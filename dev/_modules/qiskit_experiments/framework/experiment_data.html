<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>qiskit_experiments.framework.experiment_data - Qiskit Experiments 0.10.0-7-g4c5d05c4d</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=3ee1c6c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/qiskit-sphinx-theme.css?v=8ff9dcb6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-gallery.css?v=26227f6e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/customstyles.css?v=5690b376" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet"></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M14 2H2C1.73478 2 1.48043 2.10536 1.29289 2.29289C1.10536 2.48043 1 2.73478 1 3V13C1 13.2652 1.10536 13.5196 1.29289 13.7071C1.48043 13.8946 1.73478 14 2 14H14C14.2652 14 14.5196 13.8946 14.7071 13.7071C14.8946 13.5196 15 13.2652 15 13V3C15 2.73478 14.8946 2.48043 14.7071 2.29289C14.5196 2.10536 14.2652 2 14 2V2ZM2 3H10V13H2V3ZM14 13H11V3H14V13Z" fill="currentColor"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M14 3H2V4H14V3Z" fill="currentColor"/>
      <path d="M14 12H2V13H14V12Z" fill="currentColor"/>
      <path d="M14 6H2V7H14V6Z" fill="currentColor"/>
      <path d="M14 9H2V10H14V9Z" fill="currentColor"/>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M11 8L6.00005 13L5.30005 12.3L9.60005 8L5.30005 3.7L6.00005 3L11 8Z" fill="currentColor"/>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M15 13H1V14H15V13Z" fill="currentColor"/>
      <path d="M12.7 4.5C13.1 4.1 13.1 3.5 12.7 3.1L10.9 1.3C10.5 0.9 9.9 0.9 9.5 1.3L2 8.8V12H5.2L12.7 4.5ZM10.2 2L12 3.8L10.5 5.3L8.7 3.5L10.2 2ZM3 11V9.2L8 4.2L9.8 6L4.8 11H3Z" fill="currentColor"/>
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M11 13.0002C11.5523 13.0002 12 12.5525 12 12.0002C12 11.4479 11.5523 11.0002 11 11.0002C10.4477 11.0002 10 11.4479 10 12.0002C10 12.5525 10.4477 13.0002 11 13.0002Z" fill="currentColor"/>
      <path d="M14.8884 11.7394C14.5795 10.9524 14.0464 10.2734 13.3552 9.78646C12.664 9.29954 11.8451 9.02615 11 9.00017C10.1549 9.02615 9.33604 9.29954 8.64484 9.78646C7.95365 10.2734 7.42052 10.9524 7.11155 11.7394L7 12.0002L7.11155 12.2609C7.42052 13.0479 7.95365 13.727 8.64484 14.2139C9.33604 14.7008 10.1549 14.9742 11 15.0002C11.8451 14.9742 12.664 14.7008 13.3552 14.2139C14.0464 13.727 14.5795 13.0479 14.8884 12.2609L15 12.0002L14.8884 11.7394ZM11 14.0002C10.6044 14.0002 10.2178 13.8829 9.88886 13.6631C9.55996 13.4433 9.30362 13.131 9.15224 12.7655C9.00087 12.4001 8.96126 11.998 9.03843 11.61C9.1156 11.222 9.30608 10.8657 9.58579 10.586C9.86549 10.3063 10.2219 10.1158 10.6098 10.0386C10.9978 9.96143 11.3999 10.001 11.7654 10.1524C12.1308 10.3038 12.4432 10.5601 12.6629 10.889C12.8827 11.2179 13 11.6046 13 12.0002C12.9994 12.5304 12.7885 13.0388 12.4136 13.4137C12.0386 13.7887 11.5303 13.9996 11 14.0002Z" fill="currentColor"/>
      <path d="M6 14.0002H4V2.00017H8V5.00017C8.00077 5.26515 8.10637 5.51906 8.29374 5.70643C8.48111 5.8938 8.73502 5.99941 9 6.00017H12V8.00017H13V5.00017C13.0018 4.93446 12.9893 4.86913 12.9634 4.80871C12.9375 4.74828 12.8988 4.6942 12.85 4.65017L9.35 1.15017C9.30599 1.10134 9.2519 1.06263 9.19147 1.03674C9.13104 1.01084 9.06572 0.998364 9 1.00017H4C3.73502 1.00094 3.48111 1.10654 3.29374 1.29391C3.10637 1.48128 3.00077 1.73519 3 2.00017V14.0002C3.00077 14.2652 3.10637 14.5191 3.29374 14.7064C3.48111 14.8938 3.73502 14.9994 4 15.0002H6V14.0002ZM9 2.20017L11.8 5.00017H9V2.20017Z" fill="currentColor"/>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Qiskit Experiments 0.10.0-7-g4c5d05c4d</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">Qiskit Experiments 0.10.0-7-g4c5d05c4d</span>
  
</a>
<form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Qiskit Experiments Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/getting_started.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/data_processor.html">Data Processor: Wrangling data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/curve_analysis.html">Curve Analysis: Fitting your data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/visualization.html">Visualization: Creating figures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/custom_experiment.html">Writing your own experiment</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../howtos/index.html">How-To Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of How-To Guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../howtos/artifacts.html">Work with experiment artifacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtos/cloud_service.html">Save and load experiment data with the cloud service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtos/experiment_times.html">Get experiment timing information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtos/figure_generation.html">Control figure generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtos/job_splitting.html">Control the splitting of experiment circuits into jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtos/rerun_analysis.html">Rerun analysis for an existing experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtos/runtime_sessions.html">Use Experiments with Sampler</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../manuals/index.html">Experiment Manuals</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Experiment Manuals</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../manuals/verification/quantum_volume.html">Quantum Volume</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../manuals/verification/randomized_benchmarking.html">Randomized Benchmarking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../manuals/verification/state_tomography.html">Quantum State Tomography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../manuals/characterization/t1.html">T1 Characterization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../manuals/characterization/t2hahn.html">T2 Hahn Characterization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../manuals/characterization/t2ramsey.html">T2* Ramsey Characterization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../manuals/characterization/tphi.html">TÏ† Characterization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../manuals/measurement/readout_mitigation.html">Readout Mitigation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../apidocs/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../apidocs/main.html">Qiskit Experiments (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments</span></code>)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/framework.html">Experiment Framework (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.framework</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Experiment Framework (qiskit_experiments.framework)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html">ExperimentData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.ExperimentStatus.html">ExperimentStatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.AnalysisStatus.html">AnalysisStatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.AnalysisResult.html">AnalysisResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.AnalysisResultData.html">AnalysisResultData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.AnalysisResultTable.html">AnalysisResultTable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.ExperimentConfig.html">ExperimentConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.AnalysisConfig.html">AnalysisConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.ExperimentEncoder.html">ExperimentEncoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.ExperimentDecoder.html">ExperimentDecoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.ArtifactData.html">ArtifactData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.FigureData.html">FigureData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.Provider.html">Provider</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.BaseProvider.html">BaseProvider</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.IBMProvider.html">IBMProvider</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.Job.html">Job</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.BaseJob.html">BaseJob</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.ExtendedJob.html">ExtendedJob</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.MeasLevel.html">MeasLevel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.MeasReturnType.html">MeasReturnType</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.CompositeExperiment.html">CompositeExperiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.ParallelExperiment.html">ParallelExperiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.BatchExperiment.html">BatchExperiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.CompositeAnalysis.html">CompositeAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.BaseExperiment.html">BaseExperiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.BaseAnalysis.html">BaseAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.BackendData.html">BackendData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.framework.BackendTiming.html">BackendTiming</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/library.html">Experiment Library (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.library</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Experiment Library (qiskit_experiments.library)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.StandardRB.html">StandardRB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.InterleavedRB.html">InterleavedRB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.LayerFidelity.html">LayerFidelity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.LayerFidelityUnitary.html">LayerFidelityUnitary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.TomographyExperiment.html">TomographyExperiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.StateTomography.html">StateTomography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.ProcessTomography.html">ProcessTomography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.MitigatedStateTomography.html">MitigatedStateTomography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.MitigatedProcessTomography.html">MitigatedProcessTomography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.quantum_volume.QuantumVolume.html">QuantumVolume</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T1.html">T1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T2Hahn.html">T2Hahn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T2Ramsey.html">T2Ramsey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.Tphi.html">Tphi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.HalfAngle.html">HalfAngle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineAmplitude.html">FineAmplitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineXAmplitude.html">FineXAmplitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineSXAmplitude.html">FineSXAmplitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.RamseyXY.html">RamseyXY</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineFrequency.html">FineFrequency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.ReadoutAngle.html">ReadoutAngle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineDrag.html">FineDrag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineXDrag.html">FineXDrag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineSXDrag.html">FineSXDrag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.MultiStateDiscrimination.html">MultiStateDiscrimination</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.ZZRamsey.html">ZZRamsey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineZXAmplitude.html">FineZXAmplitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.LocalReadoutError.html">LocalReadoutError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.CorrelatedReadoutError.html">CorrelatedReadoutError</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/data_processing.html">Data Processing (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.data_processing</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Data Processing (qiskit_experiments.data_processing)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.DataProcessor.html">DataProcessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.DataAction.html">DataAction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.TrainableDataAction.html">TrainableDataAction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.Probability.html">Probability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.MarginalizeCounts.html">MarginalizeCounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.ToImag.html">ToImag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.ToReal.html">ToReal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.SVD.html">SVD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.DiscriminatorNode.html">DiscriminatorNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.MemoryToCounts.html">MemoryToCounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.AverageData.html">AverageData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.BasisExpectationValue.html">BasisExpectationValue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.MinMaxNormalize.html">MinMaxNormalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.ShotOrder.html">ShotOrder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.RestlessNode.html">RestlessNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.RestlessToCounts.html">RestlessToCounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.RestlessToIQ.html">RestlessToIQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.BaseDiscriminator.html">BaseDiscriminator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.SkLDA.html">SkLDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.SkQDA.html">SkQDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.BaseReadoutMitigator.html">BaseReadoutMitigator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.LocalReadoutMitigator.html">LocalReadoutMitigator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.data_processing.CorrelatedReadoutMitigator.html">CorrelatedReadoutMitigator</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/curve_analysis.html">Curve Analysis (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.curve_analysis</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Curve Analysis (qiskit_experiments.curve_analysis)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.BaseCurveAnalysis.html">BaseCurveAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.CurveAnalysis.html">CurveAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.CompositeCurveAnalysis.html">CompositeCurveAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.ScatterTable.html">ScatterTable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.CurveFitResult.html">CurveFitResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.ParameterRepr.html">ParameterRepr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.FitOptions.html">FitOptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.BlochTrajectoryAnalysis.html">BlochTrajectoryAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.DecayAnalysis.html">DecayAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.DampedOscillationAnalysis.html">DampedOscillationAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.OscillationAnalysis.html">OscillationAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.GaussianAnalysis.html">GaussianAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.ErrorAmplificationAnalysis.html">ErrorAmplificationAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.fit_function.cos.html">cos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.fit_function.cos_decay.html">cos_decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.fit_function.exponential_decay.html">exponential_decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.fit_function.gaussian.html">gaussian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.fit_function.sqrt_lorentzian.html">sqrt_lorentzian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.fit_function.sin.html">sin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.fit_function.sin_decay.html">sin_decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.constant_sinusoidal_offset.html">constant_sinusoidal_offset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.constant_spectral_offset.html">constant_spectral_offset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.exp_decay.html">exp_decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.rb_decay.html">rb_decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.full_width_half_max.html">full_width_half_max</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.frequency.html">frequency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.max_height.html">max_height</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.min_height.html">min_height</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.guess.oscillation_exp_decay.html">oscillation_exp_decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.analysis_result_to_repr.html">analysis_result_to_repr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.convert_lmfit_result.html">convert_lmfit_result</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.data_sort.html">data_sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.eval_with_uncertainties.html">eval_with_uncertainties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.filter_data.html">filter_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.inverse_weighted_variance.html">inverse_weighted_variance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.is_error_not_significant.html">is_error_not_significant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.mean_xy_data.html">mean_xy_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.multi_mean_xy_data.html">multi_mean_xy_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.level2_probability.html">level2_probability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.probability.html">probability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.sample_average.html">sample_average</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.curve_analysis.utils.shot_weighted_average.html">shot_weighted_average</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/database_service.html">Database Service (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.database_service</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Database Service (qiskit_experiments.database_service)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.database_service.DeviceComponent.html">DeviceComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.database_service.Qubit.html">Qubit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.database_service.Resonator.html">Resonator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.database_service.UnknownComponent.html">UnknownComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.database_service.to_component.html">to_component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.database_service.ExperimentDataError.html">ExperimentDataError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.database_service.ExperimentEntryExists.html">ExperimentEntryExists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.database_service.ExperimentEntryNotFound.html">ExperimentEntryNotFound</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/visualization.html">Visualization (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.visualization</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Visualization (qiskit_experiments.visualization)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.visualization.BasePlotter.html">BasePlotter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.visualization.CurvePlotter.html">CurvePlotter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.visualization.IQPlotter.html">IQPlotter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.visualization.BaseDrawer.html">BaseDrawer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.visualization.MplDrawer.html">MplDrawer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.visualization.PlotStyle.html">PlotStyle</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/test.html">Test Utilities (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.test</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Test Utilities (qiskit_experiments.test)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.test.PulseBackend.html">PulseBackend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.test.SingleTransmonTestBackend.html">SingleTransmonTestBackend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.test.MockIQBackend.html">MockIQBackend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.test.MockIQParallelBackend.html">MockIQParallelBackend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.test.T2HahnBackend.html">T2HahnBackend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.test.NoisyDelayAerBackend.html">NoisyDelayAerBackend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.test.MockIQExperimentHelper.html">MockIQExperimentHelper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.test.MockIQParallelExperimentHelper.html">MockIQParallelExperimentHelper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/mod_characterization.html">Characterization Experiments (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.library.characterization</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Characterization Experiments (qiskit_experiments.library.characterization)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T1.html">T1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T2Ramsey.html">T2Ramsey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T2Hahn.html">T2Hahn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.Tphi.html">Tphi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.HalfAngle.html">HalfAngle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineAmplitude.html">FineAmplitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineXAmplitude.html">FineXAmplitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineSXAmplitude.html">FineSXAmplitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineZXAmplitude.html">FineZXAmplitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.RamseyXY.html">RamseyXY</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineFrequency.html">FineFrequency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.ReadoutAngle.html">ReadoutAngle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineDrag.html">FineDrag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineXDrag.html">FineXDrag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineSXDrag.html">FineSXDrag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.LocalReadoutError.html">LocalReadoutError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.CorrelatedReadoutError.html">CorrelatedReadoutError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.MultiStateDiscrimination.html">MultiStateDiscrimination</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.ZZRamsey.html">ZZRamsey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T1Analysis.html">T1Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T1KerneledAnalysis.html">T1KerneledAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T2RamseyAnalysis.html">T2RamseyAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.T2HahnAnalysis.html">T2HahnAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.TphiAnalysis.html">TphiAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.FineAmplitudeAnalysis.html">FineAmplitudeAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.RamseyXYAnalysis.html">RamseyXYAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.ReadoutAngleAnalysis.html">ReadoutAngleAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.LocalReadoutErrorAnalysis.html">LocalReadoutErrorAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.CorrelatedReadoutErrorAnalysis.html">CorrelatedReadoutErrorAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.ZZRamseyAnalysis.html">ZZRamseyAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.characterization.MultiStateDiscriminationAnalysis.html">MultiStateDiscriminationAnalysis</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/mod_randomized_benchmarking.html">Randomized Benchmarking Experiments (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.library.randomized_benchmarking</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Randomized Benchmarking Experiments (qiskit_experiments.library.randomized_benchmarking)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.StandardRB.html">StandardRB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.InterleavedRB.html">InterleavedRB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.LayerFidelity.html">LayerFidelity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.LayerFidelityUnitary.html">LayerFidelityUnitary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.RBAnalysis.html">RBAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.InterleavedRBAnalysis.html">InterleavedRBAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.LayerFidelityAnalysis.html">LayerFidelityAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.RBDefaultCliffordSynthesis.html">RBDefaultCliffordSynthesis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.RBUtils.html">RBUtils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.randomized_benchmarking.CliffordUtils.html">CliffordUtils</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/mod_tomography.html">Tomography Experiments (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.library.tomography</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Tomography Experiments (qiskit_experiments.library.tomography)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.TomographyExperiment.html">TomographyExperiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.StateTomography.html">StateTomography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.ProcessTomography.html">ProcessTomography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.MitigatedStateTomography.html">MitigatedStateTomography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.MitigatedProcessTomography.html">MitigatedProcessTomography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.TomographyAnalysis.html">TomographyAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.StateTomographyAnalysis.html">StateTomographyAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.ProcessTomographyAnalysis.html">ProcessTomographyAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.MitigatedTomographyAnalysis.html">MitigatedTomographyAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.fitters.linear_inversion.html">linear_inversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.fitters.cvxpy_gaussian_lstsq.html">cvxpy_gaussian_lstsq</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.fitters.cvxpy_linear_lstsq.html">cvxpy_linear_lstsq</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.basis.PauliMeasurementBasis.html">PauliMeasurementBasis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.basis.PauliPreparationBasis.html">PauliPreparationBasis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.basis.Pauli6PreparationBasis.html">Pauli6PreparationBasis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.basis.LocalMeasurementBasis.html">LocalMeasurementBasis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.basis.LocalPreparationBasis.html">LocalPreparationBasis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.basis.MeasurementBasis.html">MeasurementBasis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.tomography.basis.PreparationBasis.html">PreparationBasis</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../apidocs/mod_quantum_volume.html">Quantum Volume Experiment (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_experiments.library.quantum_volume</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of Quantum Volume Experiment (qiskit_experiments.library.quantum_volume)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.quantum_volume.QuantumVolume.html">QuantumVolume</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.quantum_volume.QuantumVolumeAnalysis.html">QuantumVolumeAnalysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stubs/qiskit_experiments.library.quantum_volume.QuantumVolumePlotter.html">QuantumVolumePlotter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Qiskit-Community/qiskit-experiments">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://qiskit-community.github.io/qiskit-experiments/dev/">Development Branch Docs</a></li>
</ul>

</div><div class="qiskit-previous-releases-container">
    <input id="previous-releases-checkbox" name="previous-releases-checkbox" role="switch" type="checkbox">
    <div class="qiskit-previous-releases-header-container"><label for="previous-releases-checkbox">
            <p role="note">Previous Releases</p>
            <div class="qiskit-previous-releases-toggle-container">
                <div class="visually-hidden">Toggle navigation of Previous Releases</div>
                <i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i>
            </div>
        </label>
    </div>
    <div class="qiskit-previous-releases-list-container">
        <ul>
        
            <li><a href="/qiskit-experiments/stable/0.9/index.html" rel="nofollow noindex">0.9</a></li>
        
            <li><a href="/qiskit-experiments/stable/0.8/index.html" rel="nofollow noindex">0.8</a></li>
        
            <li><a href="/qiskit-experiments/stable/0.7/index.html" rel="nofollow noindex">0.7</a></li>
        
            <li><a href="/qiskit-experiments/stable/0.6/index.html" rel="nofollow noindex">0.6</a></li>
        
            <li><a href="/qiskit-experiments/stable/0.5/index.html" rel="nofollow noindex">0.5</a></li>
        
        </ul>
    </div>
</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for qiskit_experiments.framework.experiment_data</h1><div class="highlight"><pre>
<span></span><span class="c1"># This code is part of Qiskit.</span>
<span class="c1">#</span>
<span class="c1"># (C) Copyright IBM 2021.</span>
<span class="c1">#</span>
<span class="c1"># This code is licensed under the Apache License, Version 2.0. You may</span>
<span class="c1"># obtain a copy of this license in the LICENSE.txt file in the root directory</span>
<span class="c1"># of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.</span>
<span class="c1">#</span>
<span class="c1"># Any modifications or derivative works of this code must retain this</span>
<span class="c1"># copyright notice, and modified files need to carry a notice indicating</span>
<span class="c1"># that they have been altered from the originals.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Experiment Data class</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent</span><span class="w"> </span><span class="kn">import</span> <span class="n">futures</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">Result</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">PrimitiveResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.providers.jobstatus</span><span class="w"> </span><span class="kn">import</span> <span class="n">JobStatus</span><span class="p">,</span> <span class="n">JOB_FINAL_STATES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">QiskitError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.providers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Backend</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">BitArray</span><span class="p">,</span> <span class="n">SamplerPubResult</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_ibm_experiment</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">IBMExperimentService</span><span class="p">,</span>
    <span class="n">ExperimentData</span> <span class="k">as</span> <span class="n">ExperimentDataclass</span><span class="p">,</span>
    <span class="n">AnalysisResultData</span> <span class="k">as</span> <span class="n">AnalysisResultDataclass</span><span class="p">,</span>
    <span class="n">ResultQuality</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework.json</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExperimentEncoder</span><span class="p">,</span> <span class="n">ExperimentDecoder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.database_service.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">plot_to_svg_bytes</span><span class="p">,</span>
    <span class="n">ThreadSafeOrderedDict</span><span class="p">,</span>
    <span class="n">ThreadSafeList</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.database_service.device_component</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_component</span><span class="p">,</span> <span class="n">DeviceComponent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework.analysis_result</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnalysisResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework.analysis_result_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnalysisResultData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework.analysis_result_table</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnalysisResultTable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">BackendData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework.containers</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArtifactData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExperimentStatus</span><span class="p">,</span> <span class="n">AnalysisStatus</span><span class="p">,</span> <span class="n">AnalysisCallback</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework.deprecation</span><span class="w"> </span><span class="kn">import</span> <span class="n">warn_from_qe</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.framework.package_deps</span><span class="w"> </span><span class="kn">import</span> <span class="n">qiskit_version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.database_service.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ExperimentDataError</span><span class="p">,</span>
    <span class="n">ExperimentEntryNotFound</span><span class="p">,</span>
    <span class="n">ExperimentDataSaveFailed</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_experiments.database_service.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">objs_to_zip</span><span class="p">,</span> <span class="n">zip_to_objs</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.containers.figure_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">FigureData</span><span class="p">,</span> <span class="n">FigureType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.provider_interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Provider</span>


<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="c1"># There is a cyclical dependency here, but the name needs to exist for</span>
    <span class="c1"># Sphinx on Python 3.9+ to link type hints correctly.  The gating on</span>
    <span class="c1"># `TYPE_CHECKING` means that the import will never be resolved by an actual</span>
    <span class="c1"># interpreter, only static analysis.</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseExperiment</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">do_auto_save</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorate the input function to auto save data.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">return_val</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_metadata</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">return_val</span>

    <span class="k">return</span> <span class="n">_wrapped</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_utc_datetime</span><span class="p">(</span><span class="n">dt_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses UTC datetime from a string&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dt_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">db_datetime_format</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.</span><span class="si">%f</span><span class="s2">Z&quot;</span>
    <span class="n">dt_utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dt_str</span><span class="p">,</span> <span class="n">db_datetime_format</span><span class="p">)</span>
    <span class="n">dt_utc</span> <span class="o">=</span> <span class="n">dt_utc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dt_utc</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_job_status</span><span class="p">(</span><span class="n">job</span><span class="p">:</span> <span class="n">Job</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get job status in JobStatus format defined in:</span>
<span class="sd">    `from qiskit.providers.jobstatus import JobStatus`&quot;&quot;&quot;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">qe_job_status</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">JobStatus</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qe_job_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The status of job </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;which is not supported by qiskit-experiments.&quot;</span>
            <span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">qe_job_status</span>
    <span class="k">return</span> <span class="n">status</span>


<div class="viewcode-block" id="ExperimentData">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ExperimentData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Experiment data container class.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Saving experiment data to the cloud database is currently a limited access feature. You can</span>
<span class="sd">        check whether you have access by logging into the IBM Quantum interface</span>
<span class="sd">        and seeing if you can see the `database &lt;https://quantum.ibm.com/experiments&gt;`__.</span>

<span class="sd">    This class handles the following:</span>

<span class="sd">    1. Storing the data related to an experiment: raw data, metadata, analysis results,</span>
<span class="sd">       and figures</span>
<span class="sd">    2. Managing jobs and adding data from jobs automatically</span>
<span class="sd">    3. Saving and loading data from the database service</span>

<span class="sd">    The field ``db_data`` is a dataclass (``ExperimentDataclass``) containing</span>
<span class="sd">    all the data that can be stored in the database and loaded from it, and</span>
<span class="sd">    as such is subject to strict conventions.</span>

<span class="sd">    Other data fields can be added and used freely, but they won&#39;t be saved</span>
<span class="sd">    to the database.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_metadata_version</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_job_executor</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span>

    <span class="n">_json_encoder</span> <span class="o">=</span> <span class="n">ExperimentEncoder</span>
    <span class="n">_json_decoder</span> <span class="o">=</span> <span class="n">ExperimentDecoder</span>

    <span class="n">_metadata_filename</span> <span class="o">=</span> <span class="s2">&quot;metadata.json&quot;</span>
    <span class="n">_max_workers_cap</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;BaseExperiment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Backend</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">service</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IBMExperimentService</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Provider</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">job_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">child_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ExperimentData</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">db_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ExperimentDataclass</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_datetime</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize experiment data.</span>

<span class="sd">        Args:</span>
<span class="sd">            experiment: Experiment object that generated the data.</span>
<span class="sd">            backend: Backend the experiment runs on. This overrides the</span>
<span class="sd">                backend in the experiment object.</span>
<span class="sd">            service: The service that stores the experiment results to the database</span>
<span class="sd">            provider: The provider used for the experiments</span>
<span class="sd">                (can be used to automatically obtain the service)</span>
<span class="sd">            parent_id: ID of the parent experiment data</span>
<span class="sd">                in the setting of a composite experiment</span>
<span class="sd">            job_ids: IDs of jobs submitted for the experiment.</span>
<span class="sd">            child_data: List of child experiment data.</span>
<span class="sd">            verbose: Whether to print messages.</span>
<span class="sd">            db_data: A prepared ExperimentDataclass of the experiment info.</span>
<span class="sd">                This overrides other db parameters.</span>
<span class="sd">            start_datetime: The time when the experiment started running.</span>
<span class="sd">                If none, defaults to the current time.</span>

<span class="sd">        Additional info:</span>
<span class="sd">            In order to save the experiment data to the cloud service, the class</span>
<span class="sd">            needs access to the experiment service provider. It can be obtained</span>
<span class="sd">            via three different methods, given here by priority:</span>

<span class="sd">            1. Passing it directly via the ``service`` parameter.</span>
<span class="sd">            2. Implicitly obtaining it from the ``provider`` parameter.</span>
<span class="sd">            3. Implicitly obtaining it from the ``backend`` parameter, using that backend&#39;s provider.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">experiment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span> <span class="ow">or</span> <span class="n">experiment</span><span class="o">.</span><span class="n">backend</span>
            <span class="n">experiment_type</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">experiment_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Don&#39;t use None since the resultDB won&#39;t accept that</span>
            <span class="n">experiment_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">job_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">job_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment</span> <span class="o">=</span> <span class="n">experiment</span>

        <span class="c1"># data stored in the database</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">experiment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">_metadata</span><span class="p">())</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;_source&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;metadata_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_metadata_version</span><span class="p">,</span>
                <span class="s2">&quot;qiskit_version&quot;</span><span class="p">:</span> <span class="n">qiskit_version</span><span class="p">(),</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
        <span class="n">experiment_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;experiment_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">db_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span> <span class="o">=</span> <span class="n">ExperimentDataclass</span><span class="p">(</span>
                <span class="n">experiment_id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">,</span>
                <span class="n">experiment_type</span><span class="o">=</span><span class="n">experiment_type</span><span class="p">,</span>
                <span class="n">parent_id</span><span class="o">=</span><span class="n">parent_id</span><span class="p">,</span>
                <span class="n">job_ids</span><span class="o">=</span><span class="n">job_ids</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span> <span class="o">=</span> <span class="n">db_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start_datetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">=</span> <span class="n">start_datetime</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Key &#39;</span><span class="si">%s</span><span class="s2">&#39; not stored in the database&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="c1"># general data related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_provider</span> <span class="o">=</span> <span class="n">provider</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># BackendV2 has a provider attribute but BackendV3 probably will not</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_provider</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="s2">&quot;provider&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">provider</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="s2">&quot;service&quot;</span><span class="p">):</span>
            <span class="c1"># qiskit_ibm_runtime.IBMBackend stores its Provider-like object in</span>
            <span class="c1"># the &quot;service&quot; attribute</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_provider</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">service</span>
        <span class="c1"># Experiment service like qiskit_ibm_experiment.IBMExperimentService,</span>
        <span class="c1"># not to be confused with qiskit_ibm_runtime.QiskitRuntimeService</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_service</span> <span class="o">=</span> <span class="n">service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_save</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created_in_db</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_data</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="c1"># job handling related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">(</span><span class="n">job_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="c1"># Set 2 workers for analysis executor so there can be 1 actively running</span>
        <span class="c1"># future and one waiting &quot;running&quot; future. This is to allow the second</span>
        <span class="c1"># future to be cancelled without waiting for the actively running future</span>
        <span class="c1"># to finish first.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_executor</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_monitor_executor</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span>

        <span class="c1"># data storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span> <span class="o">=</span> <span class="n">ThreadSafeList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">figure_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span> <span class="o">=</span> <span class="n">AnalysisResultTable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_figures</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_analysis_results</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_artifacts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># for holding unique artifact names to be deleted</span>

        <span class="c1"># Child related</span>
        <span class="c1"># Add component data and set parent ID to current container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">child_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_child_data</span><span class="p">(</span><span class="n">child_data</span><span class="p">)</span>

    <span class="c1"># Getters/setters for experiment metadata</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the experiment for this data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseExperiment: the experiment object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">completion_times</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the completion times of the jobs.&quot;&quot;&quot;</span>
        <span class="n">job_times</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">job</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="s2">&quot;time_per_step&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;COMPLETED&quot;</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">time_per_step</span><span class="p">():</span>
                    <span class="n">job_times</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">time_per_step</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;COMPLETED&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">execution</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">(),</span> <span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution&quot;</span><span class="p">)</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;execution_spans&quot;</span> <span class="ow">in</span> <span class="n">execution</span><span class="p">:</span>
                    <span class="n">job_times</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution</span><span class="p">[</span><span class="s2">&quot;execution_spans&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">client</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="s2">&quot;_api_client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span>
                    <span class="n">client</span><span class="p">,</span> <span class="s2">&quot;job_metadata&quot;</span>
                <span class="p">):</span>
                    <span class="n">metadata</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">job_metadata</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">())</span>
                    <span class="n">finished</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;finished&quot;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="k">if</span> <span class="n">finished</span><span class="p">:</span>
                        <span class="n">job_times</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">finished</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">job_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_times</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;Could not determine job completion time. Using current timestamp.&quot;</span><span class="p">,</span>
                        <span class="ne">UserWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">job_times</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">job_times</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tags assigned to this experiment data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tags assigned to this experiment data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">tags</span>

    <span class="nd">@tags</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set tags for this experiment.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_tags</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExperimentDataError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The `tags` field of </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> must be a list.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">new_tags</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_metadata</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return experiment metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Experiment metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">metadata</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">creation_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the creation datetime of this experiment data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The timestamp when this experiment data was saved to the cloud service</span>
<span class="sd">            in the local timezone.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">creation_datetime</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the start datetime of this experiment data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The timestamp when this experiment began running in the local timezone.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">start_datetime</span>

    <span class="nd">@start_datetime</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">=</span> <span class="n">new_start_datetime</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">updated_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the update datetime of this experiment data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The timestamp when this experiment data was last updated in the service</span>
<span class="sd">            in the local timezone.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">updated_datetime</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">running_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the running time of this experiment data.</span>

<span class="sd">        The running time is the time the latest successful job started running on</span>
<span class="sd">        the remote quantum machine. This can change as more jobs finish.</span>

<span class="sd">        .. note::</span>

<span class="sd">            In practice, this property is not currently set automatically by</span>
<span class="sd">            Qiskit Experiments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">end_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the end datetime of this experiment data.</span>

<span class="sd">        The end datetime is the time the latest job data was</span>
<span class="sd">        added without errors; this can change as more jobs finish.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The timestamp when the last job of this experiment finished</span>
<span class="sd">            in the local timezone.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">end_datetime</span>

    <span class="nd">@end_datetime</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">end_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">=</span> <span class="n">new_end_datetime</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">hub</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the hub of this experiment data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The hub of this experiment data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">hub</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the group of this experiment data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The group of this experiment data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">group</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the project of this experiment data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The project of this experiment data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">project</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">experiment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return experiment ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            Experiment ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">experiment_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">experiment_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return experiment type</span>

<span class="sd">        Returns:</span>
<span class="sd">            Experiment type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">experiment_type</span>

    <span class="nd">@experiment_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">experiment_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the parent id&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">experiment_type</span> <span class="o">=</span> <span class="n">new_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return parent experiment ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            Parent ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">parent_id</span>

    <span class="nd">@parent_id</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the parent id&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">new_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">job_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return experiment job IDs.</span>

<span class="sd">        Returns: IDs of jobs submitted for this experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">job_ids</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">figure_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return names of the figures associated with this experiment.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Names of figures associated with this experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">figure_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">share_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the share level for this experiment</span>

<span class="sd">        Returns:</span>
<span class="sd">            Experiment share level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">share_level</span>

    <span class="nd">@share_level</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">share_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_level</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the experiment share level,</span>
<span class="sd">           to this experiment itself and its descendants.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_level: New experiment share level. Valid share levels are provider-</span>
<span class="sd">                specified. For example, IBM Quantum experiment service allows</span>
<span class="sd">                &quot;public&quot;, &quot;hub&quot;, &quot;group&quot;, &quot;project&quot;, and &quot;private&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">share_level</span> <span class="o">=</span> <span class="n">new_level</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">original_auto_save</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">auto_save</span>
            <span class="n">data</span><span class="o">.</span><span class="n">auto_save</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">data</span><span class="o">.</span><span class="n">share_level</span> <span class="o">=</span> <span class="n">new_level</span>
            <span class="n">data</span><span class="o">.</span><span class="n">auto_save</span> <span class="o">=</span> <span class="n">original_auto_save</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_metadata</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">notes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return experiment notes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Experiment notes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">notes</span>

    <span class="nd">@notes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">notes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_notes</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update experiment notes.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_notes: New experiment notes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">notes</span> <span class="o">=</span> <span class="n">new_notes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_metadata</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">backend_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the backend&#39;s name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">backend</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">backend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Backend</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return backend.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>

    <span class="nd">@backend</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_backend</span><span class="p">:</span> <span class="n">Backend</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update backend.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_backend: New backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_backend</span><span class="p">(</span><span class="n">new_backend</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_metadata</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_backend</span><span class="p">:</span> <span class="n">Backend</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set backend.</span>
<span class="sd">        Args:</span>
<span class="sd">            new_backend: New backend.</span>
<span class="sd">            recursive: should set the backend for children as well</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># defined independently from the setter to enable setting without autosave</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">new_backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_data</span> <span class="o">=</span> <span class="n">BackendData</span><span class="p">(</span><span class="n">new_backend</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend_data</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_backend</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="s2">&quot;_instance&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">_instance</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hgp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">_instance</span>
        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">child_data</span><span class="p">():</span>
                <span class="n">data</span><span class="o">.</span><span class="n">_set_backend</span><span class="p">(</span><span class="n">new_backend</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">hgp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns Hub/Group/Project data as a formatted string&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hub</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@hgp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">hgp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_hgp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the Hub/Group/Project data from a formatted string&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^/]*/[^/]*/[^/]*$&quot;</span><span class="p">,</span> <span class="n">new_hgp</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span><span class="s2">&quot;hgp can be only given in a &lt;hub&gt;/&lt;group&gt;/&lt;project&gt; format&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">hub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">new_hgp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete all currently stored analysis results and figures&quot;&quot;&quot;</span>
        <span class="c1"># Schedule existing analysis results for deletion next save call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_analysis_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">result_ids</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># Schedule existing figures for deletion next save call</span>
        <span class="c1"># TODO: Fully delete artifacts from the service</span>
        <span class="c1"># Current implementation uploads empty files instead</span>
        <span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_artifacts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">artifact</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_figures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">figure_names</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IBMExperimentService</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the database service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Service that can be used to access this experiment in a database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_service</span>

    <span class="nd">@service</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="n">IBMExperimentService</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the service to be used for storing experiment data</span>

<span class="sd">        Args:</span>
<span class="sd">            service: Service to be used.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExperimentDataError: If an experiment service is already being used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_service</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_infer_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to configure service if it has not been configured</span>

<span class="sd">        This method should be called before any method that needs to work with</span>
<span class="sd">        the experiment service.</span>

<span class="sd">        Args:</span>
<span class="sd">            warn: Warn if the service could not be set up from the backend or</span>
<span class="sd">                provider attributes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if a service instance has been set up</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_service_from_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_service_from_provider</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">provider</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">warn</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Experiment service has not been configured. Can not save!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="n">IBMExperimentService</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the service to be used for storing experiment data,</span>
<span class="sd">           to this experiment itself and its descendants.</span>

<span class="sd">        Args:</span>
<span class="sd">            service: Service to be used.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExperimentDataError: If an experiment service is already being used and `replace==False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_service</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExperimentDataError</span><span class="p">(</span><span class="s2">&quot;An experiment service is already being used.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_service</span> <span class="o">=</span> <span class="n">service</span>
        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;auto_save&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">child_data</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">_set_service</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>

<div class="viewcode-block" id="ExperimentData.get_service_from_backend">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.get_service_from_backend">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_service_from_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IBMExperimentService</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the service from the backend data&quot;&quot;&quot;</span>
        <span class="c1"># backend.provider is not checked since currently the only viable way</span>
        <span class="c1"># to set up the experiment service is using the credentials from</span>
        <span class="c1"># QiskitRuntimeService on a qiskit_ibm_runtime.IBMBackend.</span>
        <span class="n">provider</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="s2">&quot;service&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ExperimentData</span><span class="o">.</span><span class="n">get_service_from_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExperimentData.get_service_from_provider">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.get_service_from_provider">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_service_from_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IBMExperimentService</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the service from the provider data&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="s2">&quot;active_account&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">account</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">active_account</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">IBMExperimentService</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to connect to experiment service&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">provider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Provider</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the backend provider.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Provider that is used to obtain backends and job data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_provider</span>

    <span class="nd">@provider</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">provider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="n">Provider</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the provider to be used for obtaining job data</span>

<span class="sd">        Args:</span>
<span class="sd">            provider: Provider to be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_provider</span> <span class="o">=</span> <span class="n">provider</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">auto_save</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return current auto-save option.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether changes will be automatically saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_save</span>

    <span class="nd">@auto_save</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">auto_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_val</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set auto save preference.</span>

<span class="sd">        Args:</span>
<span class="sd">            save_val: Whether to do auto-save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># children will be saved once we set auto_save for them</span>
        <span class="k">if</span> <span class="n">save_val</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_children</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_save</span> <span class="o">=</span> <span class="n">save_val</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">child_data</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">auto_save</span> <span class="o">=</span> <span class="n">save_val</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the class name and version.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span>

    <span class="c1"># Data addition and deletion</span>

<div class="viewcode-block" id="ExperimentData.add_data">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Result</span><span class="p">,</span> <span class="n">PrimitiveResult</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Result</span> <span class="o">|</span> <span class="n">PrimitiveResult</span><span class="p">],</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add experiment data.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Experiment data to add. Several types are accepted for convenience:</span>

<span class="sd">                * Result: Add data from this ``Result`` object.</span>
<span class="sd">                * List[Result]: Add data from the ``Result`` objects.</span>
<span class="sd">                * Dict: Add this data.</span>
<span class="sd">                * List[Dict]: Add this list of data.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the input data type is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">future</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Not all analysis has finished running. Adding new data may &quot;</span>
                <span class="s2">&quot;create unexpected analysis results.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>

        <span class="c1"># Directly add non-job data</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="p">(</span><span class="n">Result</span><span class="p">,</span> <span class="n">PrimitiveResult</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_result_data</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExperimentData.add_jobs">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_jobs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_jobs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">jobs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Job</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Job</span><span class="p">]],</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add experiment data.</span>

<span class="sd">        Args:</span>
<span class="sd">            jobs: The Job or list of Jobs to add result data from.</span>
<span class="sd">            timeout: Optional, time in seconds to wait for all jobs to finish</span>
<span class="sd">                     before cancelling them.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the input data type is invalid.</span>

<span class="sd">        .. note::</span>
<span class="sd">            If a timeout is specified the :meth:`cancel_jobs` method will be</span>
<span class="sd">            called after timing out to attempt to cancel any unfinished jobs.</span>

<span class="sd">            If you want to wait for jobs without cancelling, use the timeout</span>
<span class="sd">            kwarg of :meth:`block_for_results` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">future</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Not all analysis has finished running. Adding new jobs may &quot;</span>
                <span class="s2">&quot;create unexpected analysis results.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jobs</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">jobs</span><span class="p">]</span>

        <span class="c1"># Add futures for extracting finished job data</span>
        <span class="n">timeout_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="s2">&quot;backend&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">backend_name</span> <span class="o">=</span> <span class="n">BackendData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">job_backend_name</span> <span class="o">=</span> <span class="n">BackendData</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">backend</span><span class="p">())</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="ow">and</span> <span class="n">backend_name</span> <span class="o">!=</span> <span class="n">job_backend_name</span><span class="p">:</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Adding a job from a backend (</span><span class="si">%s</span><span class="s2">) that is different &quot;</span>
                            <span class="s2">&quot;than the current backend (</span><span class="si">%s</span><span class="s2">). &quot;</span>
                            <span class="s2">&quot;The new backend will be used, but &quot;</span>
                            <span class="s2">&quot;service is not changed if one already exists.&quot;</span><span class="p">,</span>
                            <span class="n">job</span><span class="o">.</span><span class="n">backend</span><span class="p">(),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">backend</span><span class="p">()</span>

            <span class="n">jid</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Skipping duplicate job, a job with this ID already exists [Job ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">jid</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span>
                <span class="k">if</span> <span class="n">jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Job future has already been submitted [Job ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_job_future</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">timeout_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span>

        <span class="c1"># Add future for cancelling jobs that timeout</span>
        <span class="k">if</span> <span class="n">timeout_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_job_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout_running_jobs</span><span class="p">,</span> <span class="n">timeout_ids</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_metadata</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_timeout_running_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_ids</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function for cancelling jobs after timeout length.</span>

<span class="sd">        This function should be submitted to an executor to run as a future.</span>

<span class="sd">        Args:</span>
<span class="sd">            job_ids: the IDs of jobs to wait for.</span>
<span class="sd">            timeout: The total time to wait for all jobs before cancelling.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">futs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">job_ids</span><span class="p">]</span>
        <span class="n">waited</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">futs</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

        <span class="c1"># Try to cancel timed-out jobs</span>
        <span class="k">if</span> <span class="n">waited</span><span class="o">.</span><span class="n">not_done</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cancelling running jobs that exceeded add_jobs timeout.&quot;</span><span class="p">)</span>
            <span class="n">done_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">waited</span><span class="o">.</span><span class="n">done</span><span class="p">}</span>
            <span class="n">notdone_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">jid</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">job_ids</span> <span class="k">if</span> <span class="n">jid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">done_ids</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_jobs</span><span class="p">(</span><span class="n">notdone_ids</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_job_future</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit new _add_job_data job to executor&quot;&quot;&quot;</span>
        <span class="n">jid</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Job future has already been submitted [Job ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_job_data</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_job_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job</span><span class="p">:</span> <span class="n">Job</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for a job to finish and add job result data.</span>

<span class="sd">        Args:</span>
<span class="sd">            job: the Job to wait for and add data from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (str, bool) of the job id and bool of if the job data was added.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If an error occurred when adding job data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">jid</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">job_result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_result_data</span><span class="p">(</span><span class="n">job_result</span><span class="p">,</span> <span class="n">jid</span><span class="p">)</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Job data added [Job ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="p">)</span>
            <span class="c1"># sets the endtime to be the time the last successful job was added</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">jid</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
            <span class="c1"># Handle cancelled jobs</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">get_job_status</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Job was cancelled before completion [Job ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">jid</span><span class="p">,</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Job data not added for errored job [Job ID: </span><span class="si">%s</span><span class="s2">]</span><span class="se">\n</span><span class="s2">Error message: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">jid</span><span class="p">,</span>
                    <span class="n">job</span><span class="o">.</span><span class="n">error_message</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="s2">&quot;error_message&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;n/a&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">jid</span><span class="p">,</span> <span class="kc">False</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Adding data from job failed [Job ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">())</span>
            <span class="k">raise</span> <span class="n">ex</span>

<div class="viewcode-block" id="ExperimentData.add_analysis_callback">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_analysis_callback">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_analysis_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add analysis callback for running after experiment data jobs are finished.</span>

<span class="sd">        This method adds the `callback` function to a queue to be run</span>
<span class="sd">        asynchronously after completion of any running jobs, or immediately</span>
<span class="sd">        if no running jobs. If this method is called multiple times the</span>
<span class="sd">        callback functions will be executed in the order they were</span>
<span class="sd">        added.</span>

<span class="sd">        Args:</span>
<span class="sd">            callback: Callback function invoked when job finishes successfully.</span>
<span class="sd">                      The callback function will be called as</span>
<span class="sd">                      ``callback(expdata, **kwargs)`` where `expdata` is this</span>
<span class="sd">                      ``DbExperimentData`` object, and `kwargs` are any additional</span>
<span class="sd">                      keyword arguments passed to this method.</span>
<span class="sd">            **kwargs: Keyword arguments to be passed to the callback function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">lock</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="c1"># Create callback dataclass</span>
            <span class="n">cid</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="n">AnalysisCallback</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="n">callback_id</span><span class="o">=</span><span class="n">cid</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Futures to wait for</span>
            <span class="n">futs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="n">wait_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monitor_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_futures</span><span class="p">,</span> <span class="n">futs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;jobs and analysis&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Create a future to monitor event for calls to cancel_analysis</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">_monitor_cancel</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">cancel_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monitor_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">_monitor_cancel</span><span class="p">)</span>

            <span class="c1"># Add run analysis future</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_analysis_callback</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">wait_future</span><span class="p">,</span> <span class="n">cancel_future</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_run_analysis_callback</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">callback_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">wait_future</span><span class="p">:</span> <span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">,</span>
        <span class="n">cancel_future</span><span class="p">:</span> <span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run an analysis callback after specified futures have finished.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callback_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No analysis callback with id </span><span class="si">{</span><span class="n">callback_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Monitor jobs and cancellation event to see if callback should be run</span>
        <span class="c1"># or cancelled</span>
        <span class="c1"># Future which returns if either all jobs finish, or cancel event is set</span>
        <span class="n">waited</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">([</span><span class="n">wait_future</span><span class="p">,</span> <span class="n">cancel_future</span><span class="p">],</span> <span class="n">return_when</span><span class="o">=</span><span class="s2">&quot;FIRST_COMPLETED&quot;</span><span class="p">)</span>
        <span class="n">cancel</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">waited</span><span class="o">.</span><span class="n">done</span><span class="p">)</span>

        <span class="c1"># Ensure monitor event is set so monitor future can terminate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">callback_id</span><span class="p">]</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If not ready cancel the callback before running</span>
        <span class="k">if</span> <span class="n">cancel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">callback_id</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">CANCELLED</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Cancelled analysis callback [Experiment ID: </span><span class="si">%s</span><span class="s2">][Analysis Callback ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                <span class="n">callback_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">callback_id</span><span class="p">,</span> <span class="kc">False</span>

        <span class="c1"># Run callback function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">callback_id</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">RUNNING</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Running analysis callback &#39;</span><span class="si">%s</span><span class="s2">&#39; [Experiment ID: </span><span class="si">%s</span><span class="s2">][Analysis Callback ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">callback_id</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                <span class="n">callback_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">callback_id</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">DONE</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Analysis callback finished [Experiment ID: </span><span class="si">%s</span><span class="s2">][Analysis Callback ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                <span class="n">callback_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">callback_id</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">callback_id</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">ERROR</span>
            <span class="n">tb_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">))</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Analysis callback failed [Experiment ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[Analysis Callback ID: </span><span class="si">{</span><span class="n">callback_id</span><span class="si">}</span><span class="s2">]:</span><span class="se">\n</span><span class="si">{</span><span class="n">tb_text</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">[</span><span class="n">callback_id</span><span class="p">]</span><span class="o">.</span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">error_msg</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">callback_id</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_result_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Result</span> <span class="o">|</span> <span class="n">PrimitiveResult</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add data from a Result object</span>

<span class="sd">        Args:</span>
<span class="sd">            result: Result object containing data to be added.</span>
<span class="sd">            job_id: The id of the job the result came from. If `None`, the</span>
<span class="sd">            job id in `result` is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">):</span>
            <span class="c1"># backend run results</span>
            <span class="k">if</span> <span class="n">job_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">job_id</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">job_id</span>
            <span class="k">if</span> <span class="n">job_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="c1"># Lock data while adding all result data</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">results</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;job_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_id</span>
                    <span class="k">if</span> <span class="s2">&quot;counts&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                        <span class="c1"># Format to Counts object rather than hex dict</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">expr_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr_result</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr_result</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr_result</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">metadata</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr_result</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr_result</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr_result</span><span class="o">.</span><span class="n">shots</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meas_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr_result</span><span class="o">.</span><span class="n">meas_level</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr_result</span><span class="p">,</span> <span class="s2">&quot;meas_return&quot;</span><span class="p">):</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meas_return&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr_result</span><span class="o">.</span><span class="n">meas_return</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># sampler results</span>
            <span class="k">if</span> <span class="n">job_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span><span class="s2">&quot;job_id must be provided, not available in the sampler result&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="c1"># Lock data while adding all result data</span>
                <span class="c1"># Sampler results are a list</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="c1"># convert to a Sampler Pub Result (can remove this later when the bug is fixed)</span>
                    <span class="n">testres</span> <span class="o">=</span> <span class="n">SamplerPubResult</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;job_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_id</span>
                    <span class="k">if</span> <span class="n">testres</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                        <span class="n">joined_data</span> <span class="o">=</span> <span class="n">testres</span><span class="o">.</span><span class="n">join_data</span><span class="p">()</span>
                        <span class="n">outer_shape</span> <span class="o">=</span> <span class="n">testres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
                        <span class="k">if</span> <span class="n">outer_shape</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Outer PUB dimensions </span><span class="si">{</span><span class="n">outer_shape</span><span class="si">}</span><span class="s2"> found in result. &quot;</span>
                                <span class="s2">&quot;Only unparameterized PUBs are currently supported by &quot;</span>
                                <span class="s2">&quot;qiskit-experiments.&quot;</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">joined_data</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">joined_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># No data, usually this only happens in tests</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joined_data</span><span class="p">,</span> <span class="n">BitArray</span><span class="p">):</span>
                        <span class="c1"># bit results so has counts</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meas_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                        <span class="c1"># The sampler result always contains bitstrings. At</span>
                        <span class="c1"># this point, we have lost track of whether the job</span>
                        <span class="c1"># requested memory/meas_return=single. Here we just</span>
                        <span class="c1"># hope that nothing breaks if we always return single</span>
                        <span class="c1"># shot results since the counts dict is also returned</span>
                        <span class="c1"># any way.</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meas_return&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;single&quot;</span>
                        <span class="c1"># join the data</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testres</span><span class="o">.</span><span class="n">join_data</span><span class="p">(</span><span class="n">testres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testres</span><span class="o">.</span><span class="n">join_data</span><span class="p">(</span><span class="n">testres</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">get_bitstrings</span><span class="p">()</span>
                        <span class="c1"># number of shots</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joined_data</span><span class="o">.</span><span class="n">num_shots</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joined_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meas_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">joined_data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meas_return&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;avg&quot;</span>
                            <span class="c1"># TODO: we either need to track shots in the</span>
                            <span class="c1"># circuit metadata and pull it out here or get</span>
                            <span class="c1"># upstream to report the number of shots in the</span>
                            <span class="c1"># sampler result for level 1 avg data.</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">joined_data</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">joined_data</span><span class="p">)</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">joined_data</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meas_return&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;single&quot;</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joined_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">joined_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">joined_data</span><span class="p">)</span>
                            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">joined_data</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected result format: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">joined_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># Some Sampler implementations remove the circuit metadata</span>
                    <span class="c1"># which some experiment Analysis classes need. Here we try</span>
                    <span class="c1"># to put it back from the circuits themselves.</span>
                    <span class="k">if</span> <span class="s2">&quot;circuit_metadata&quot;</span> <span class="ow">in</span> <span class="n">testres</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testres</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;circuit_metadata&quot;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">corresponding_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;pubs&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">circuit</span> <span class="o">=</span> <span class="n">corresponding_pub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">metadata</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_retrieve_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve job data if missing experiment data.&quot;&quot;&quot;</span>
        <span class="c1"># Get job results if missing in experiment data.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">provider</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># &#39;self._result_data&#39; could be locked, so I check a copy of it.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                <span class="c1"># Adding warning so the user will have indication why the analysis may fail.</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Provider for ExperimentData object doesn&#39;t exist, resulting in a failed attempt to&quot;</span>
                    <span class="s2">&quot; retrieve data from the server; no stored result data exists&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">retrieved_jobs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">jobs_to_retrieve</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># the list of all jobs to retrieve from the server</span>

        <span class="c1"># first find which jobs are listed in the `job_ids` field of the experiment data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">jid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">jobs_to_retrieve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">jobs_to_retrieve</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Retrieving job [Job ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># qiskit-ibm-runtime syntax</span>
                <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">job</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span>
                <span class="n">retrieved_jobs</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Unable to retrieve data from job [Job ID: </span><span class="si">%s</span><span class="s2">]: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="p">)</span>
        <span class="c1"># Add retrieved job objects to stored jobs and extract data</span>
        <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">retrieved_jobs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span>
            <span class="k">if</span> <span class="n">get_job_status</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="ow">in</span> <span class="n">JOB_FINAL_STATES</span><span class="p">:</span>
                <span class="c1"># Add job results synchronously</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_job_data</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Add job results asynchronously</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_job_future</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

<div class="viewcode-block" id="ExperimentData.data">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the experiment data at the specified index.</span>

<span class="sd">        Args:</span>
<span class="sd">            index: Index of the data to be returned.</span>
<span class="sd">                Several types are accepted for convenience:</span>

<span class="sd">                    * None: Return all experiment data.</span>
<span class="sd">                    * int: Specific index of the data.</span>
<span class="sd">                    * slice: A list slice of data indexes.</span>
<span class="sd">                    * str: ID of the job that produced the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Experiment data.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the input `index` has an invalid type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;job_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">index</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid index type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExperimentData.add_figures">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_figures">[docs]</a>
    <span class="nd">@do_auto_save</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_figures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figures</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">FigureType</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FigureType</span><span class="p">]],</span>
        <span class="n">figure_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">save_figure</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the experiment figure.</span>

<span class="sd">        Args:</span>
<span class="sd">            figures: Paths of the figure files or figure data.</span>
<span class="sd">            figure_names: Names of the figures. If ``None``, use the figure file</span>
<span class="sd">                names, if given, or a generated name of the format ``experiment_type``, figure</span>
<span class="sd">                index, first 5 elements of ``device_components``, and first 8 digits of the</span>
<span class="sd">                experiment ID connected by underscores, such as ``T1_Q0_0123abcd.svg``. If `figures`</span>
<span class="sd">                is a list, then `figure_names` must also be a list of the same length or ``None``.</span>
<span class="sd">            overwrite: Whether to overwrite the figure if one already exists with</span>
<span class="sd">                the same name. By default, overwrite is ``False`` and the figure will be renamed</span>
<span class="sd">                with an incrementing numerical suffix. For example, trying to save ``figure.svg`` when</span>
<span class="sd">                ``figure.svg`` already exists will save it as ``figure-1.svg``, and trying to save</span>
<span class="sd">                ``figure-1.svg`` when ``figure-1.svg`` already exists will save it as ``figure-2.svg``.</span>
<span class="sd">            save_figure: Whether to save the figure in the database. If ``None``,</span>
<span class="sd">                the ``auto-save`` attribute is used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure names in SVG format.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an input parameter has an invalid value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">figure_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">figure_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">figure_names</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figures</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">figures</span> <span class="o">=</span> <span class="p">[</span><span class="n">figures</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">figure_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">figure_names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The parameter figure_names must be None or a list of &quot;</span>
                <span class="s2">&quot;the same size as the parameter figures.&quot;</span>
            <span class="p">)</span>

        <span class="n">added_figs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">figure</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">figures</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">figure_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># figure is a filename, so we use it as the name</span>
                    <span class="n">fig_name</span> <span class="o">=</span> <span class="n">figure</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">FigureData</span><span class="p">):</span>
                    <span class="c1"># Generate a name in the form StandardRB_Q0_Q1_Q2_b4f1d8ad-1.svg</span>
                    <span class="n">fig_name</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_type</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_components&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[])[:</span><span class="mi">5</span><span class="p">])</span><span class="si">}</span><span class="s1">_&#39;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">.svg&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Keep the existing figure name if there is one</span>
                    <span class="n">fig_name</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig_name</span> <span class="o">=</span> <span class="n">figure_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fig_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.svg&quot;</span><span class="p">):</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File name </span><span class="si">%s</span><span class="s2"> does not have an SVG extension. A &#39;.svg&#39; is added.&quot;</span><span class="p">)</span>
                <span class="n">fig_name</span> <span class="o">+=</span> <span class="s2">&quot;.svg&quot;</span>

            <span class="n">existing_figure</span> <span class="o">=</span> <span class="n">fig_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span>
            <span class="k">if</span> <span class="n">existing_figure</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="c1"># Remove any existing suffixes then generate new figure name</span>
                <span class="c1"># StandardRB_Q0_Q1_Q2_b4f1d8ad.svg becomes StandardRB_Q0_Q1_Q2_b4f1d8ad</span>
                <span class="n">fig_name_chunked</span> <span class="o">=</span> <span class="n">fig_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fig_name_chunked</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Figure name already has a suffix</span>
                    <span class="c1"># This extracts StandardRB_Q0_Q1_Q2_b4f1d8ad as the prefix from</span>
                    <span class="c1"># StandardRB_Q0_Q1_Q2_b4f1d8ad-1.svg</span>
                    <span class="n">fig_name_prefix</span> <span class="o">=</span> <span class="n">fig_name_chunked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fig_name_suffix</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fig_name_chunked</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># the suffix is not an int, add our own suffix</span>
                        <span class="c1"># my-custom-figure-name will be the prefix of my-custom-figure-name.svg</span>
                        <span class="n">fig_name_prefix</span> <span class="o">=</span> <span class="n">fig_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">fig_name_suffix</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># StandardRB_Q0_Q1_Q2_b4f1d8ad.svg has no hyphens so</span>
                    <span class="c1"># StandardRB_Q0_Q1_Q2_b4f1d8ad would be its prefix</span>
                    <span class="n">fig_name_prefix</span> <span class="o">=</span> <span class="n">fig_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">fig_name_suffix</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">fig_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name_prefix</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">fig_name_suffix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.svg&quot;</span>
                <span class="k">while</span> <span class="n">fig_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="p">:</span>  <span class="c1"># Increment suffix until the name isn&#39;t taken</span>
                    <span class="c1"># If StandardRB_Q0_Q1_Q2_b4f1d8ad-1.svg already exists,</span>
                    <span class="c1"># StandardRB_Q0_Q1_Q2_b4f1d8ad-2.svg will be the name of this figure</span>
                    <span class="n">fig_name_suffix</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">fig_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_name_prefix</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">fig_name_suffix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.svg&quot;</span>

            <span class="c1"># figure_data = None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">figure</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># check whether the figure is already wrapped, meaning it came from a sub-experiment</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">FigureData</span><span class="p">):</span>
                <span class="n">figure_data</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">)</span>
                <span class="n">figure</span> <span class="o">=</span> <span class="n">figure_data</span><span class="o">.</span><span class="n">figure</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">figure_metadata</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;qubits&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;physical_qubits&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;device_components&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_components&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;experiment_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_type</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">figure_data</span> <span class="o">=</span> <span class="n">FigureData</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">figure_metadata</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="p">[</span><span class="n">fig_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">figure_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">figure_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig_name</span><span class="p">)</span>

            <span class="n">save</span> <span class="o">=</span> <span class="n">save_figure</span> <span class="k">if</span> <span class="n">save_figure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span>
            <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_service</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
                    <span class="n">figure</span> <span class="o">=</span> <span class="n">plot_to_svg_bytes</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">create_or_update_figure</span><span class="p">(</span>
                    <span class="n">experiment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                    <span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span>
                    <span class="n">figure_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span>
                    <span class="n">create</span><span class="o">=</span><span class="ow">not</span> <span class="n">existing_figure</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">added_figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">added_figs</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">added_figs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">added_figs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="ExperimentData.delete_figure">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.delete_figure">[docs]</a>
    <span class="nd">@do_auto_save</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_figure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figure_key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the experiment figure.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_key: Name or index of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Figure name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExperimentEntryNotFound: If the figure is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">figure_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_figure_key</span><span class="p">(</span><span class="n">figure_key</span><span class="p">)</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="p">[</span><span class="n">figure_key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_figures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_service</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">service_exception_to_warning</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">delete_figure</span><span class="p">(</span><span class="n">experiment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">figure_name</span><span class="o">=</span><span class="n">figure_key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_figures</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">figure_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">figure_key</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_find_figure_key</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figure_key</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A helper method to find figure key.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">figure_key</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">figure_key</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExperimentEntryNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Figure index </span><span class="si">{</span><span class="n">figure_key</span><span class="si">}</span><span class="s2"> out of range.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">figure_key</span><span class="p">]</span>

        <span class="c1"># All figures must have &#39;.svg&#39; in their names when added, as the extension is added to the key</span>
        <span class="c1"># name in the `add_figures()` method of this class.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">figure_key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.svg&quot;</span><span class="p">):</span>
                <span class="n">figure_key</span> <span class="o">+=</span> <span class="s2">&quot;.svg&quot;</span>

        <span class="k">if</span> <span class="n">figure_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExperimentEntryNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Figure key </span><span class="si">{</span><span class="n">figure_key</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">figure_key</span>

<div class="viewcode-block" id="ExperimentData.figure">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.figure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">figure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figure_key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">FigureData</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the specified experiment figure.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_key: Name or index of the figure.</span>
<span class="sd">            file_name: Name of the local file to save the figure to. If ``None``,</span>
<span class="sd">                the content of the figure is returned instead.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The size of the figure if `file_name` is specified. Otherwise the</span>
<span class="sd">            content of the figure as a `FigureData` object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExperimentEntryNotFound: If the figure cannot be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">figure_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_figure_key</span><span class="p">(</span><span class="n">figure_key</span><span class="p">)</span>

        <span class="n">figure_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">figure_key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">figure_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_service</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">experiment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">figure_name</span><span class="o">=</span><span class="n">figure_key</span><span class="p">)</span>
            <span class="n">figure_data</span> <span class="o">=</span> <span class="n">FigureData</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">figure</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">figure_key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="p">[</span><span class="n">figure_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">figure_data</span>

        <span class="k">if</span> <span class="n">figure_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExperimentEntryNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Figure </span><span class="si">{</span><span class="n">figure_key</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">num_bytes</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">figure_data</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">num_bytes</span>
        <span class="k">return</span> <span class="n">figure_data</span></div>


<div class="viewcode-block" id="ExperimentData.add_analysis_result">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_analysis_result">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_analysis_result</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">DeviceComponent</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">experiment_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">result_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">run_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">created_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_values</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the analysis result.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method is wrapper around</span>
<span class="sd">            :meth:`.ExperimentData.add_analysis_results` which could originally</span>
<span class="sd">            accept multiple analysis results in a list. The supported mode</span>
<span class="sd">            going forward is to call this method with only a single result at a</span>
<span class="sd">            time.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the result entry.</span>
<span class="sd">            value: Analyzed quantity.</span>
<span class="sd">            quality: Quality of the data.</span>
<span class="sd">            components: Associated device components.</span>
<span class="sd">            experiment: String identifier of the associated experiment.</span>
<span class="sd">            experiment_id: ID of the associated experiment.</span>
<span class="sd">            result_id: ID of this analysis entry. If not set a random UUID is generated.</span>
<span class="sd">            tags: List of arbitrary tags.</span>
<span class="sd">            backend: Name of associated backend.</span>
<span class="sd">            run_time: The date time when the experiment started to run on the device.</span>
<span class="sd">            created_time: The date time when this analysis is performed.</span>
<span class="sd">            extra_values: Arbitrary keyword arguments for supplementary information.</span>
<span class="sd">                New dataframe columns are created in the analysis result table with added keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_analysis_results</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
            <span class="n">quality</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span>
            <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
            <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span>
            <span class="n">experiment_id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">,</span>
            <span class="n">result_id</span><span class="o">=</span><span class="n">result_id</span><span class="p">,</span>
            <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
            <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
            <span class="n">run_time</span><span class="o">=</span><span class="n">run_time</span><span class="p">,</span>
            <span class="n">created_time</span><span class="o">=</span><span class="n">created_time</span><span class="p">,</span>
            <span class="o">**</span><span class="n">extra_values</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ExperimentData.add_analysis_results">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_analysis_results">[docs]</a>
    <span class="nd">@do_auto_save</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_analysis_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AnalysisResult</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">AnalysisResult</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">DeviceComponent</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">experiment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">experiment_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">result_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">run_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">created_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_values</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the analysis result.</span>

<span class="sd">        .. deprecated:: 0.9.0</span>

<span class="sd">          Passing a value for the ``results`` argument is deprecated and support</span>
<span class="sd">          will be removed in a future release. Instead, analysis results should</span>
<span class="sd">          be created by passing in the individual keyword argument fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            results: Analysis results to be saved.</span>
<span class="sd">            name: Name of the result entry.</span>
<span class="sd">            value: Analyzed quantity.</span>
<span class="sd">            quality: Quality of the data.</span>
<span class="sd">            components: Associated device components.</span>
<span class="sd">            experiment: String identifier of the associated experiment.</span>
<span class="sd">            experiment_id: ID of the associated experiment.</span>
<span class="sd">            result_id: ID of this analysis entry. If not set a random UUID is generated.</span>
<span class="sd">            tags: List of arbitrary tags.</span>
<span class="sd">            backend: Name of associated backend.</span>
<span class="sd">            run_time: The date time when the experiment started to run on the device.</span>
<span class="sd">            created_time: The date time when this analysis is performed.</span>
<span class="sd">            extra_values: Arbitrary keyword arguments for supplementary information.</span>
<span class="sd">                New dataframe columns are created in the analysis result table with added keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># NOTE: this path is deprecated</span>
            <span class="n">warn_from_qe</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Calling ExperimentData.add_analysis_results() with a &quot;</span>
                    <span class="s2">&quot;`results` argument is deprecated as of qiskit-experiments &quot;</span>
                    <span class="s2">&quot;0.9.0. Code should be updated to pass the keyword &quot;</span>
                    <span class="s2">&quot;arguments of `add_analysis_results` &quot;</span>
                    <span class="s2">&quot;directly for each result. The `results` argument will be &quot;</span>
                    <span class="s2">&quot;removed in a future release.&quot;</span>
                <span class="p">),</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">extra_values</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">extra</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">chisq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Move chisq to extra.</span>
                    <span class="c1"># This is not global outcome, e.g. QPT doesn&#39;t provide chisq.</span>
                    <span class="n">extra_values</span><span class="p">[</span><span class="s2">&quot;chisq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">chisq</span>
                <span class="n">experiment</span> <span class="o">=</span> <span class="n">extra_values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;experiment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_type</span><span class="p">)</span>
                <span class="n">backend</span> <span class="o">=</span> <span class="n">extra_values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;backend&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_name</span><span class="p">)</span>
                <span class="n">run_time</span> <span class="o">=</span> <span class="n">extra_values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;run_time&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_time</span><span class="p">)</span>
                <span class="n">created_time</span> <span class="o">=</span> <span class="n">extra_values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;created_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">quality</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span>
                    <span class="n">components</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">device_components</span><span class="p">,</span>
                    <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span>
                    <span class="n">experiment_id</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                    <span class="n">result_id</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">result_id</span><span class="p">,</span>
                    <span class="n">tags</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
                    <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
                    <span class="n">run_time</span><span class="o">=</span><span class="n">run_time</span><span class="p">,</span>
                    <span class="n">created_time</span><span class="o">=</span><span class="n">created_time</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">extra_values</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">experiment</span> <span class="o">=</span> <span class="n">experiment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_type</span>
            <span class="n">experiment_id</span> <span class="o">=</span> <span class="n">experiment_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_name</span>

            <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span>
                <span class="n">result_id</span><span class="o">=</span><span class="n">result_id</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                <span class="n">quality</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span>
                <span class="n">components</span><span class="o">=</span><span class="n">components</span> <span class="ow">or</span> <span class="p">[],</span>
                <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span>
                <span class="n">experiment_id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">,</span>
                <span class="n">tags</span><span class="o">=</span><span class="n">tags</span> <span class="ow">or</span> <span class="p">[],</span>
                <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
                <span class="n">run_time</span><span class="o">=</span><span class="n">run_time</span><span class="p">,</span>
                <span class="n">created_time</span><span class="o">=</span><span class="n">created_time</span><span class="p">,</span>
                <span class="o">**</span><span class="n">extra_values</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_service</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">service_result</span> <span class="o">=</span> <span class="n">_series_to_service_result</span><span class="p">(</span>
                    <span class="n">series</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">,</span>
                    <span class="n">auto_save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">service_result</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>


<div class="viewcode-block" id="ExperimentData.delete_analysis_result">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.delete_analysis_result">[docs]</a>
    <span class="nd">@do_auto_save</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_analysis_result</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result_key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the analysis result.</span>

<span class="sd">        Args:</span>
<span class="sd">            result_key: ID or index of the analysis result to be deleted.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Deleted analysis result IDs.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExperimentEntryNotFound: If analysis result not found or multiple entries are found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">del_data</span><span class="p">(</span><span class="n">result_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_save</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_service</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">service_exception_to_warning</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">uids</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">delete_analysis_result</span><span class="p">(</span><span class="n">result_id</span><span class="o">=</span><span class="n">uid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_analysis_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">uids</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">uids</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_retrieve_analysis_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve service analysis results.</span>

<span class="sd">        Args:</span>
<span class="sd">            refresh: Retrieve the latest analysis results from the server, if</span>
<span class="sd">                an experiment service is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get job results if missing experiment data.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">refresh</span><span class="p">):</span>
            <span class="n">retrieved_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">analysis_results</span><span class="p">(</span>
                <span class="n">experiment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_decoder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_decoder</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">retrieved_results</span><span class="p">:</span>
                <span class="c1"># Canonicalize IBM specific data structure.</span>
                <span class="c1"># TODO define proper data schema on frontend and delegate this to service.</span>
                <span class="n">cano_quality</span> <span class="o">=</span> <span class="n">AnalysisResult</span><span class="o">.</span><span class="n">RESULT_QUALITY_TO_TEXT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                <span class="n">cano_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_component</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">device_components</span><span class="p">]</span>
                <span class="n">extra</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;_extra&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">chisq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;chisq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">chisq</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">result_type</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;_value&quot;</span><span class="p">],</span>
                    <span class="n">quality</span><span class="o">=</span><span class="n">cano_quality</span><span class="p">,</span>
                    <span class="n">components</span><span class="o">=</span><span class="n">cano_components</span><span class="p">,</span>
                    <span class="n">experiment_id</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                    <span class="n">result_id</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">result_id</span><span class="p">,</span>
                    <span class="n">tags</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
                    <span class="n">backend</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">backend_name</span><span class="p">,</span>
                    <span class="n">created_time</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">creation_datetime</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">extra</span><span class="p">,</span>
                <span class="p">)</span>

<div class="viewcode-block" id="ExperimentData.analysis_results">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.analysis_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">analysis_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">block</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">dataframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalysisResult</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">AnalysisResult</span><span class="p">]</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return analysis results associated with this experiment.</span>

<span class="sd">        .. deprecated:: 0.6.0</span>
<span class="sd">            Retrieving analysis results by a numerical index, whether an integer or a slice,</span>
<span class="sd">            is deprecated as of 0.6 and will be removed in a future release. Use the name</span>
<span class="sd">            or ID of the result instead.</span>

<span class="sd">        .. deprecated:: 0.9.0</span>
<span class="sd">            Not setting the ``dataframe`` argument to ``True`` when calling</span>
<span class="sd">            this method is deprecated. Currently, not doing results in the old</span>
<span class="sd">            path of returning :class:`.AnalysisResult` objects but future</span>
<span class="sd">            releases might change the default to behave as though ``dataframe``</span>
<span class="sd">            had been passed as ``True`` and remove support for setting</span>
<span class="sd">            ``dataframe`` to ``False``.</span>

<span class="sd">        When this method is called with ``dataframe=True`` you will receive</span>
<span class="sd">        matched result entries with the ``index`` condition in the dataframe format.</span>
<span class="sd">        You can access a certain entry value by specifying its row index by either</span>
<span class="sd">        row number or short index string. For example,</span>

<span class="sd">        .. jupyter-input::</span>

<span class="sd">            results = exp_data.analysis_results(&quot;res1&quot;, dataframe=True)</span>

<span class="sd">            print(results)</span>

<span class="sd">        .. jupyter-output::</span>

<span class="sd">                      name  experiment  components  value  quality  backend          run_time</span>
<span class="sd">            7dd286f4  res1       MyExp    [Q0, Q1]      1     good    test1  2024-02-06 13:46</span>
<span class="sd">            f62042a7  res1       MyExp    [Q2, Q3]      2     good    test1  2024-02-06 13:46</span>

<span class="sd">        Getting the first result value with a row number (``iloc``).</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            value = results.iloc[0].value</span>

<span class="sd">        Getting the first result value with a short index (``loc``).</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            value = results.loc[&quot;7dd286f4&quot;]</span>

<span class="sd">        See the pandas `DataFrame`_ documentation for the tips about data handling.</span>

<span class="sd">        .. _DataFrame: https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html</span>

<span class="sd">        Args:</span>
<span class="sd">            index: Index of the analysis result to be returned.</span>
<span class="sd">                Several types are accepted for convenience:</span>

<span class="sd">                * None: Return all analysis results.</span>
<span class="sd">                * int: Specific index of the analysis results.</span>
<span class="sd">                * slice: A list slice of indexes.</span>
<span class="sd">                * str: ID or name of the analysis result.</span>

<span class="sd">            refresh: Retrieve the latest analysis results from the server, if</span>
<span class="sd">                an experiment service is available.</span>
<span class="sd">            block: If ``True``, block for any analysis callbacks to finish running.</span>
<span class="sd">            timeout: max time in seconds to wait for analysis callbacks to finish running.</span>
<span class="sd">            columns: Specifying a set of columns to return. You can pass a list of each</span>
<span class="sd">                column name to return, otherwise builtin column groups are available:</span>

<span class="sd">                * ``all``: Return all columns, including metadata to communicate</span>
<span class="sd">                  with the experiment service, such as entry IDs.</span>
<span class="sd">                * ``default``: Return columns including analysis result with supplementary</span>
<span class="sd">                  information about experiment.</span>
<span class="sd">                * ``minimal``: Return only analysis subroutine returns.</span>

<span class="sd">            dataframe: Set to ``True`` to return analysis results in the dataframe format.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A copy of analysis results data. Updating the returned object doesn&#39;t</span>
<span class="sd">            mutate the original dataset.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExperimentEntryNotFound: If the entry cannot be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_futures</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;analysis&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_analysis_results</span><span class="p">(</span><span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dataframe</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

        <span class="n">warn_from_qe</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;Leaving `dataframe` unset or setting it to `False` for &quot;</span>
                <span class="s2">&quot;`ExperimentData.analysis_results` is deprecated as of &quot;</span>
                <span class="s2">&quot;qiskit-experiments 0.9.0. Future releases may change the &quot;</span>
                <span class="s2">&quot;default to `True` and remove the option to set the value to &quot;</span>
                <span class="s2">&quot;`False`.&quot;</span>
            <span class="p">),</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Convert back into List[AnalysisResult] which is payload for IBM experiment service.</span>
        <span class="c1"># This will be removed in future version.</span>
        <span class="n">tmp_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
        <span class="n">service_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">tmp_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">service_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">_series_to_service_result</span><span class="p">(</span>
                    <span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">,</span>
                    <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">,</span>
                    <span class="n">auto_save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_auto_save</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)):</span>
            <span class="n">warn_from_qe</span><span class="p">(</span>
                <span class="s2">&quot;Accessing analysis results via a numerical index is deprecated and will be &quot;</span>
                <span class="s2">&quot;removed in a future release. Use the ID or name of the analysis result &quot;</span>
                <span class="s2">&quot;instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">service_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">service_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">service_results</span></div>


    <span class="c1"># Save and load from the database</span>

<div class="viewcode-block" id="ExperimentData.save_metadata">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.save_metadata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save this experiments metadata to a database service.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method does not save analysis results, figures, or artifacts.</span>
<span class="sd">            Use :meth:`save` for general saving of all experiment data.</span>

<span class="sd">            See :meth:`qiskit.providers.experiment.IBMExperimentService.create_experiment`</span>
<span class="sd">            for fields that are saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_infer_service</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_experiment_metadata</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">child_data</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">save_metadata</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_save_experiment_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suppress_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save this experiments metadata to a database service.</span>
<span class="sd">        Args:</span>
<span class="sd">            suppress_errors: should the method catch exceptions (true) or</span>
<span class="sd">            pass them on, potentially aborting the experiment (false)</span>
<span class="sd">        Raises:</span>
<span class="sd">            QiskitError: If the save to the database failed</span>
<span class="sd">        .. note::</span>
<span class="sd">            This method does not save analysis results nor figures.</span>
<span class="sd">            Use :meth:`save` for general saving of all experiment data.</span>

<span class="sd">            See :meth:`qiskit.providers.experiment.IBMExperimentService.create_experiment`</span>
<span class="sd">            for fields that are saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Experiment cannot be saved because no experiment service is available. &quot;</span>
                <span class="s2">&quot;An experiment service is available, for example, &quot;</span>
                <span class="s2">&quot;when using an IBM Quantum backend.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">handle_metadata_separately</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_too_large</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">handle_metadata_separately</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">metadata</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">create_or_update_experiment</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="p">,</span> <span class="n">json_encoder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_in_db</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">created_datetime</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">updated_datetime</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">creation_datetime</span> <span class="o">=</span> <span class="n">parse_utc_datetime</span><span class="p">(</span><span class="n">created_datetime</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">updated_datetime</span> <span class="o">=</span> <span class="n">parse_utc_datetime</span><span class="p">(</span><span class="n">updated_datetime</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_created_in_db</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">handle_metadata_separately</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">file_upload</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_filename</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="p">,</span>
                    <span class="n">json_encoder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
            <span class="c1"># Don&#39;t automatically fail the experiment just because its data cannot be saved.</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unable to save the experiment data: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment data save failed</span><span class="se">\n</span><span class="s2">Error Message:</span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ex</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_metadata_too_large</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines whether the metadata should be stored in a separate file&quot;&quot;&quot;</span>
        <span class="c1"># currently the entire POST JSON request body is limited by default to 100kb</span>
        <span class="n">total_metadata_size</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">total_metadata_size</span> <span class="o">&gt;</span> <span class="mi">10000</span>

    <span class="c1"># Save and load from the database</span>

<div class="viewcode-block" id="ExperimentData.save">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">suppress_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">save_figures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">save_artifacts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">save_children</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the experiment data to a database service.</span>

<span class="sd">        Args:</span>
<span class="sd">            suppress_errors: should the method catch exceptions (true) or</span>
<span class="sd">                pass them on, potentially aborting the experiment (false)</span>
<span class="sd">            max_workers: Maximum number of concurrent worker threads (default 3, maximum 10)</span>
<span class="sd">            save_figures: Whether to save figures in the database or not</span>
<span class="sd">            save_artifacts: Whether to save artifacts in the database</span>
<span class="sd">            save_children: For composite experiments, whether to save children as well</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExperimentDataSaveFailed: If no experiment database service</span>
<span class="sd">            was found, or the experiment service failed to save</span>

<span class="sd">        .. note::</span>
<span class="sd">            This saves the experiment metadata, all analysis results, and all</span>
<span class="sd">            figures. Depending on the number of figures and analysis results this</span>
<span class="sd">            operation could take a while.</span>

<span class="sd">            To only update a previously saved experiments metadata (eg for</span>
<span class="sd">            additional tags or notes) use :meth:`save_metadata`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO - track changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_infer_service</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Experiment cannot be saved because no experiment service is available. &quot;</span>
                <span class="s2">&quot;An experiment service is available, for example, &quot;</span>
                <span class="s2">&quot;when using an IBM Quantum backend.&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">suppress_errors</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExperimentDataSaveFailed</span><span class="p">(</span><span class="s2">&quot;No service found&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_workers</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_workers_cap</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;max_workers cannot be larger than </span><span class="si">%s</span><span class="s2">. Setting max_workers = </span><span class="si">%s</span><span class="s2"> now.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_workers_cap</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_workers_cap</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">max_workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_workers_cap</span>

        <span class="k">if</span> <span class="n">save_artifacts</span><span class="p">:</span>
            <span class="c1"># populate the metadata entry for artifact file names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;artifact_files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">artifact</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.zip&quot;</span> <span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_save_experiment_metadata</span><span class="p">(</span><span class="n">suppress_errors</span><span class="o">=</span><span class="n">suppress_errors</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_in_db</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not save experiment metadata to DB, aborting experiment save&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">analysis_results_to_create</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># TODO We should support saving entire dataframe</span>
            <span class="c1">#  Calling API per entry takes huge amount of time.</span>
            <span class="n">legacy_result</span> <span class="o">=</span> <span class="n">_series_to_service_result</span><span class="p">(</span>
                <span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">,</span>
                <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">,</span>
                <span class="n">auto_save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">analysis_results_to_create</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">legacy_result</span><span class="o">.</span><span class="n">_db_data</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">create_analysis_results</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">analysis_results_to_create</span><span class="p">,</span>
                <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">json_encoder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="p">,</span>
                <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
            <span class="c1"># Don&#39;t automatically fail the experiment just because its data cannot be saved.</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unable to save the experiment data: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExperimentDataSaveFailed</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Analysis result save failed</span><span class="se">\n</span><span class="s2">Error Message:</span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ex</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_analysis_results</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">service_exception_to_warning</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">delete_analysis_result</span><span class="p">(</span><span class="n">result_id</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_analysis_results</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save_figures</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="n">figures_to_create</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">figure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="c1"># currently only the figure and its name are stored in the database</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">FigureData</span><span class="p">):</span>
                        <span class="n">figure</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">figure</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Figure metadata is currently not saved to the database&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
                        <span class="n">figure</span> <span class="o">=</span> <span class="n">plot_to_svg_bytes</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
                    <span class="n">figures_to_create</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">figure</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">create_figures</span><span class="p">(</span>
                    <span class="n">experiment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                    <span class="n">figure_list</span><span class="o">=</span><span class="n">figures_to_create</span><span class="p">,</span>
                    <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_figures</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">service_exception_to_warning</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">delete_figure</span><span class="p">(</span><span class="n">experiment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">figure_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_figures</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># save artifacts</span>
        <span class="k">if</span> <span class="n">save_artifacts</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="c1"># make dictionary {artifact name: [artifact ids]}</span>
                <span class="n">artifact_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">artifact_list</span><span class="p">[</span><span class="n">artifact</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artifact</span><span class="o">.</span><span class="n">artifact_id</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">artifact_name</span><span class="p">,</span> <span class="n">artifact_ids</span> <span class="ow">in</span> <span class="n">artifact_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">file_zipped</span> <span class="o">=</span> <span class="n">objs_to_zip</span><span class="p">(</span>
                            <span class="n">artifact_ids</span><span class="p">,</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">[</span><span class="n">artifact_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">artifact_id</span> <span class="ow">in</span> <span class="n">artifact_ids</span><span class="p">],</span>
                            <span class="n">json_encoder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">file_upload</span><span class="p">(</span>
                            <span class="n">experiment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">artifact_name</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">,</span>
                            <span class="n">file_data</span><span class="o">=</span><span class="n">file_zipped</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unable to save artifacts: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

            <span class="c1"># Upload a blank file if the whole file should be deleted</span>
            <span class="c1"># TODO: replace with direct artifact deletion when available</span>
            <span class="k">for</span> <span class="n">artifact_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_artifacts</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>  <span class="c1"># Don&#39;t overwrite with a blank file if there&#39;s still artifacts with this name</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">artifacts</span><span class="p">(</span><span class="n">artifact_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except:</span>
                    <span class="k">with</span> <span class="n">service_exception_to_warning</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">file_upload</span><span class="p">(</span>
                            <span class="n">experiment_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">artifact_name</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">,</span>
                            <span class="n">file_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="c1"># Even if we didn&#39;t overwrite an artifact file, we don&#39;t need to keep this because</span>
                <span class="c1"># an existing artifact(s) needs to be deleted to delete the artifact file in the future</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_artifacts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">artifact_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">local</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;You can view the experiment online at &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;https://quantum.ibm.com/experiments/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="c1"># handle children, but without additional prints</span>
        <span class="k">if</span> <span class="n">save_children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">original_verbose</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">verbose</span>
                <span class="n">data</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">data</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                    <span class="n">suppress_errors</span><span class="o">=</span><span class="n">suppress_errors</span><span class="p">,</span>
                    <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
                    <span class="n">save_figures</span><span class="o">=</span><span class="n">save_figures</span><span class="p">,</span>
                    <span class="n">save_artifacts</span><span class="o">=</span><span class="n">save_artifacts</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">data</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">original_verbose</span></div>


<div class="viewcode-block" id="ExperimentData.jobs">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.jobs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Job</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of jobs for the experiment&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>


<div class="viewcode-block" id="ExperimentData.cancel_jobs">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.cancel_jobs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_jobs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancel any running jobs.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Job(s) to cancel. If None all non-finished jobs will be cancelled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the specified jobs were successfully cancelled</span>
<span class="sd">            otherwise false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">ids</span><span class="p">]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">all_cancelled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="n">job</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">ids</span> <span class="ow">and</span> <span class="n">jid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
                    <span class="c1"># Skip cancelling this callback</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">job</span> <span class="ow">and</span> <span class="n">get_job_status</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">JOB_FINAL_STATES</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">job</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cancelled job [Job ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
                        <span class="n">all_cancelled</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unable to cancel job [Job ID: </span><span class="si">%s</span><span class="s2">]:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="c1"># Remove done or cancelled job futures</span>
                <span class="k">if</span> <span class="n">jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">all_cancelled</span></div>


<div class="viewcode-block" id="ExperimentData.cancel_analysis">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.cancel_analysis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_analysis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancel any queued analysis callbacks.</span>

<span class="sd">        .. note::</span>
<span class="sd">            A currently running analysis callback cannot be cancelled.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Analysis callback(s) to cancel. If None all non-finished</span>
<span class="sd">                 analysis will be cancelled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the specified analysis callbacks were successfully</span>
<span class="sd">            cancelled otherwise false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">ids</span><span class="p">]</span>

        <span class="c1"># Lock analysis futures so we can&#39;t add more while trying to cancel</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">all_cancelled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">not_running</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cid</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">ids</span> <span class="ow">and</span> <span class="n">cid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
                    <span class="c1"># Skip cancelling this callback</span>
                    <span class="k">continue</span>

                <span class="c1"># Set event to cancel callback</span>
                <span class="n">callback</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

                <span class="c1"># Check for running callback that can&#39;t be cancelled</span>
                <span class="k">if</span> <span class="n">callback</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
                    <span class="n">all_cancelled</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to cancel running analysis callback [Experiment ID: </span><span class="si">%s</span><span class="s2">]&quot;</span>
                        <span class="s2">&quot;[Analysis Callback ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                        <span class="n">cid</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">not_running</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>

            <span class="c1"># Wait for completion of other futures cancelled via event.set</span>
            <span class="n">waited</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">not_running</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Get futures that didn&#39;t raise exception</span>
            <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">waited</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">exception</span><span class="p">():</span>
                    <span class="n">cid</span> <span class="o">=</span> <span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">cid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="p">:</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">all_cancelled</span></div>


<div class="viewcode-block" id="ExperimentData.cancel">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.cancel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attempt to cancel any running jobs and queued analysis callbacks.</span>

<span class="sd">        .. note::</span>
<span class="sd">            A running analysis callback cannot be cancelled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all jobs and analysis are successfully cancelled, otherwise false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Cancel analysis first since it is queued on jobs, then cancel jobs</span>
        <span class="c1"># otherwise there can be a race issue when analysis starts running</span>
        <span class="c1"># as soon as jobs are cancelled</span>
        <span class="n">analysis_cancelled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel_analysis</span><span class="p">()</span>
        <span class="n">jobs_cancelled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel_jobs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">analysis_cancelled</span> <span class="ow">and</span> <span class="n">jobs_cancelled</span></div>


<div class="viewcode-block" id="ExperimentData.block_for_results">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.block_for_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">block_for_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ExperimentData&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Block until all pending jobs and analysis callbacks finish.</span>

<span class="sd">        Args:</span>
<span class="sd">            timeout: Timeout in seconds for waiting for results.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The experiment data with finished jobs and post-processing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">lock</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="c1"># Lock threads to get all current job and analysis futures</span>
            <span class="c1"># at the time of function call and then release the lock</span>
            <span class="n">job_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">job_futs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="n">analysis_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">analysis_futs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c1"># Wait for futures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_futures</span><span class="p">(</span><span class="n">job_futs</span> <span class="o">+</span> <span class="n">analysis_futs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;jobs and analysis&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="c1"># Clean up done job futures</span>
        <span class="n">num_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">job_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="n">fut</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">job_ids</span><span class="p">,</span> <span class="n">job_futs</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span> <span class="ow">or</span> <span class="n">fut</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span>
                    <span class="n">num_jobs</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c1"># Clean up done analysis futures</span>
        <span class="n">num_analysis</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cid</span><span class="p">,</span> <span class="n">fut</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">analysis_ids</span><span class="p">,</span> <span class="n">analysis_futs</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span> <span class="ow">or</span> <span class="n">fut</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span>
                    <span class="n">num_analysis</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c1"># Check if more futures got added while this function was running</span>
        <span class="c1"># and block recursively. This could happen if an analysis callback</span>
        <span class="c1"># spawns another callback or creates more jobs</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_jobs</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_analysis</span><span class="p">:</span>
            <span class="n">time_taken</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">timeout</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">-</span> <span class="n">time_taken</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_for_results</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_wait_for_futures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">futs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;futures&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for jobs to finish running.</span>

<span class="sd">        Args:</span>
<span class="sd">            futs: Job or analysis futures to wait for.</span>
<span class="sd">            name: type name for future for logger messages.</span>
<span class="sd">            timeout: The length of time to wait for all jobs</span>
<span class="sd">                     before returning False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all jobs finished. False if timeout time was reached</span>
<span class="sd">            or any jobs were cancelled or had an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">waited</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">futs</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Log futures still running after timeout</span>
        <span class="k">if</span> <span class="n">waited</span><span class="o">.</span><span class="n">not_done</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Waiting for </span><span class="si">%s</span><span class="s2"> timed out before completion [Experiment ID: </span><span class="si">%s</span><span class="s2">].&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Check for futures that were cancelled or errored</span>
        <span class="n">excepts</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">waited</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="n">fut</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">excepts</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">))</span>
                <span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">fut</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> was cancelled before completion [Experiment ID: </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># The job/analysis did not succeed, and the failure reflects in the second</span>
                <span class="c1"># returned value of _add_job_data/_run_analysis_callback. See details in Issue #866.</span>
                <span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">excepts</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> raised exceptions [Experiment ID: </span><span class="si">%s</span><span class="s2">]:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">excepts</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="ExperimentData.status">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.status">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExperimentStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the experiment status.</span>

<span class="sd">        Possible return values for :class:`.ExperimentStatus` are</span>

<span class="sd">        * :attr:`~.ExperimentStatus.EMPTY` - experiment data is empty</span>
<span class="sd">        * :attr:`~.ExperimentStatus.INITIALIZING` - experiment jobs are being initialized</span>
<span class="sd">        * :attr:`~.ExperimentStatus.QUEUED` - experiment jobs are queued</span>
<span class="sd">        * :attr:`~.ExperimentStatus.RUNNING` - experiment jobs is actively running</span>
<span class="sd">        * :attr:`~.ExperimentStatus.CANCELLED` - experiment jobs or analysis has been cancelled</span>
<span class="sd">        * :attr:`~.ExperimentStatus.POST_PROCESSING` - experiment analysis is actively running</span>
<span class="sd">        * :attr:`~.ExperimentStatus.DONE` - experiment jobs and analysis have successfully run</span>
<span class="sd">        * :attr:`~.ExperimentStatus.ERROR` - experiment jobs or analysis incurred an error</span>

<span class="sd">        .. note::</span>

<span class="sd">            If an experiment has status :attr:`~.ExperimentStatus.ERROR`</span>
<span class="sd">            there may still be pending or running jobs. In these cases it</span>
<span class="sd">            may be beneficial to call :meth:`cancel_jobs` to terminate these</span>
<span class="sd">            remaining jobs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The experiment status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">container</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">EMPTY</span>

        <span class="c1"># Return job status is job is not DONE</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">INITIALIZING</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">INITIALIZING</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">QUEUED</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">QUEUED</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">VALIDATING</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">VALIDATING</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">job_status</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Return analysis status if Done, cancelled or error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">DONE</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">DONE</span><span class="p">,</span>
                <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">,</span>
                <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_status</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ExperimentStatus</span><span class="o">.</span><span class="n">POST_PROCESSING</span></div>


<div class="viewcode-block" id="ExperimentData.job_status">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.job_status">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">job_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the experiment job execution status.</span>

<span class="sd">        Possible return values for :class:`qiskit.providers.jobstatus.JobStatus` are</span>

<span class="sd">        * ``ERROR`` - if any job incurred an error</span>
<span class="sd">        * ``CANCELLED`` - if any job is cancelled.</span>
<span class="sd">        * ``RUNNING`` - if any job is still running.</span>
<span class="sd">        * ``QUEUED`` - if any job is queued.</span>
<span class="sd">        * ``VALIDATING`` - if any job is being validated.</span>
<span class="sd">        * ``INITIALIZING`` - if any job is being initialized.</span>
<span class="sd">        * ``DONE`` - if all jobs are finished.</span>

<span class="sd">        .. note::</span>

<span class="sd">            If an experiment has status ``ERROR`` or ``CANCELLED`` there may still be</span>
<span class="sd">            pending or running jobs. In these cases it may be beneficial to call</span>
<span class="sd">            :meth:`cancel_jobs` to terminate these remaining jobs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The job execution status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="c1"># No jobs present</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">DONE</span>

            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">job</span><span class="p">:</span>
                    <span class="n">statuses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>

        <span class="c1"># If any jobs are in non-DONE state return that state</span>
        <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">,</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">QUEUED</span><span class="p">,</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">VALIDATING</span><span class="p">,</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">INITIALIZING</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stat</span>

        <span class="k">return</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">DONE</span></div>


<div class="viewcode-block" id="ExperimentData.analysis_status">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.analysis_status">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">analysis_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalysisStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the data analysis post-processing status.</span>

<span class="sd">        Possible return values for :class:`.AnalysisStatus` are</span>

<span class="sd">        * :attr:`~.AnalysisStatus.ERROR` - if any analysis callback incurred an error</span>
<span class="sd">        * :attr:`~.AnalysisStatus.CANCELLED` - if any analysis callback is cancelled.</span>
<span class="sd">        * :attr:`~.AnalysisStatus.RUNNING` - if any analysis callback is actively running.</span>
<span class="sd">        * :attr:`~.AnalysisStatus.QUEUED` - if any analysis callback is queued.</span>
<span class="sd">        * :attr:`~.AnalysisStatus.DONE` - if all analysis callbacks have successfully run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Then analysis status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">statuses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">,</span>
            <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
            <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">QUEUED</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stat</span>

        <span class="k">return</span> <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">DONE</span></div>


<div class="viewcode-block" id="ExperimentData.job_errors">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.job_errors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">job_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return any errors encountered in job execution.&quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get any job errors</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">job</span> <span class="ow">and</span> <span class="n">get_job_status</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="o">==</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="s2">&quot;error_message&quot;</span><span class="p">):</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">error_message</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Job ID: </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Get any job futures errors:</span>
        <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="n">fut</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fut</span> <span class="ow">and</span> <span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="n">fut</span><span class="o">.</span><span class="n">exception</span><span class="p">():</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">fut</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[Job ID: </span><span class="si">{</span><span class="n">jid</span><span class="si">}</span><span class="s2">]&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExperimentData.analysis_errors">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.analysis_errors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">analysis_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return any errors encountered during analysis callbacks.&quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get any callback errors</span>
        <span class="k">for</span> <span class="n">cid</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">callback</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">AnalysisStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Analysis Callback ID: </span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">callback</span><span class="o">.</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExperimentData.errors">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.errors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return errors encountered during job and analysis execution.</span>

<span class="sd">        .. note::</span>
<span class="sd">            To display only job or analysis errors use the</span>
<span class="sd">            :meth:`job_errors` or :meth:`analysis_errors` methods.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Experiment errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_errors</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_errors</span><span class="p">()</span></div>


    <span class="c1"># Children handling</span>

<div class="viewcode-block" id="ExperimentData.add_child_data">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_child_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_child_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_data</span><span class="p">:</span> <span class="n">ExperimentData</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add child experiment data to the current experiment data&quot;&quot;&quot;</span>
        <span class="n">experiment_data</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="p">[</span><span class="n">experiment_data</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">experiment_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;child_data_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>


<div class="viewcode-block" id="ExperimentData.child_data">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.child_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">child_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ExperimentData</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ExperimentData</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return child experiment data.</span>

<span class="sd">        Args:</span>
<span class="sd">            index: Index of the child experiment data to be returned.</span>
<span class="sd">                Several types are accepted for convenience:</span>

<span class="sd">                    * None: Return all child data.</span>
<span class="sd">                    * int: Specific index of the child data.</span>
<span class="sd">                    * slice: A list slice of indexes.</span>
<span class="sd">                    * str: experiment ID of the child data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The requested single or list of child experiment data.</span>

<span class="sd">        Raises:</span>
<span class="sd">            QiskitError: If the index or ID of the child experiment data</span>
<span class="sd">                         cannot be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid index type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExperimentData.load">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.load">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">experiment_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">service</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IBMExperimentService</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Provider</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ExperimentData&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a saved experiment data from a database service.</span>

<span class="sd">        Args:</span>
<span class="sd">            experiment_id: Experiment ID.</span>
<span class="sd">            service: the database service.</span>
<span class="sd">            provider: an IBMProvider required for loading job data and</span>
<span class="sd">                can be used to initialize the service. When using</span>
<span class="sd">                :external+qiskit_ibm_runtime:doc:`qiskit-ibm-runtime &lt;index&gt;`,</span>
<span class="sd">                this is the :class:`~qiskit_ibm_runtime.QiskitRuntimeService` and should</span>
<span class="sd">                not be confused with the experiment database service</span>
<span class="sd">                :meth:`qiskit_ibm_experiment.IBMExperimentService`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The loaded experiment data.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ExperimentDataError: If not service nor provider were given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">provider</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExperimentDataError</span><span class="p">(</span>
                    <span class="s2">&quot;Loading an experiment requires a valid Qiskit provider or experiment service.&quot;</span>
                <span class="p">)</span>
            <span class="n">service</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_service_from_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">experiment</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">json_decoder</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_json_decoder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">service</span><span class="o">.</span><span class="n">experiment_has_file</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_metadata_filename</span><span class="p">):</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">file_download</span><span class="p">(</span>
                <span class="n">experiment_id</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_metadata_filename</span><span class="p">,</span> <span class="n">json_decoder</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_json_decoder</span>
            <span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>

        <span class="n">expdata</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">,</span> <span class="n">db_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">provider</span><span class="o">=</span><span class="n">provider</span><span class="p">)</span>

        <span class="c1"># Retrieve data and analysis results</span>
        <span class="c1"># Maybe this isn&#39;t necessary but the repr of the class should</span>
        <span class="c1"># be updated to show correct number of results including remote ones</span>
        <span class="n">expdata</span><span class="o">.</span><span class="n">_retrieve_data</span><span class="p">()</span>
        <span class="n">expdata</span><span class="o">.</span><span class="n">_retrieve_analysis_results</span><span class="p">()</span>

        <span class="c1"># Recreate artifacts</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;artifact_files&quot;</span> <span class="ow">in</span> <span class="n">expdata</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">expdata</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;artifact_files&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">service</span><span class="o">.</span><span class="n">experiment_has_file</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
                        <span class="n">artifact_file</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">file_download</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">zip_to_objs</span><span class="p">(</span><span class="n">artifact_file</span><span class="p">,</span> <span class="n">json_decoder</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_json_decoder</span><span class="p">):</span>
                            <span class="n">expdata</span><span class="o">.</span><span class="n">add_artifacts</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unable to load artifacts: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

        <span class="c1"># mark it as existing in the DB</span>
        <span class="n">expdata</span><span class="o">.</span><span class="n">_created_in_db</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">child_data_ids</span> <span class="o">=</span> <span class="n">expdata</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;child_data_ids&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">child_data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ExperimentData</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span> <span class="k">for</span> <span class="n">child_id</span> <span class="ow">in</span> <span class="n">child_data_ids</span>
        <span class="p">]</span>
        <span class="n">expdata</span><span class="o">.</span><span class="n">_set_child_data</span><span class="p">(</span><span class="n">child_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">expdata</span></div>


<div class="viewcode-block" id="ExperimentData.copy">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.copy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ExperimentData&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a copy of the experiment data with a new experiment ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            copy_results: If True copy the analysis results, figures, and artifacts</span>
<span class="sd">                          into the returned container, along with the</span>
<span class="sd">                          experiment data and metadata. If False only copy</span>
<span class="sd">                          the experiment data and metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A copy of the experiment data object with the same data</span>
<span class="sd">            but different IDs.</span>

<span class="sd">        .. note:</span>
<span class="sd">            If analysis results and figures are copied they will also have</span>
<span class="sd">            new result IDs and figure names generated for the copies.</span>

<span class="sd">            This method can not be called from an analysis callback. It waits</span>
<span class="sd">            for analysis callbacks to complete before copying analysis results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_instance</span> <span class="o">=</span> <span class="n">ExperimentData</span><span class="p">(</span>
            <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
            <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">,</span>
            <span class="n">provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">provider</span><span class="p">,</span>
            <span class="n">parent_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span><span class="p">,</span>
            <span class="n">job_ids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_ids</span><span class="p">,</span>
            <span class="n">child_data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">new_instance</span><span class="o">.</span><span class="n">_db_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Figure names shouldn&#39;t be copied over</span>
        <span class="n">new_instance</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">figure_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_instance</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">experiment_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># different id for copied experiment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_instance</span><span class="o">.</span><span class="n">_experiment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_instance</span><span class="o">.</span><span class="n">_experiment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Copying experiment data [Experiment ID: </span><span class="si">%s</span><span class="s2">]: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
            <span class="n">new_instance</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Copy basic properties and metadata</span>

        <span class="n">new_instance</span><span class="o">.</span><span class="n">_jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">copy_object</span><span class="p">()</span>
        <span class="n">new_instance</span><span class="o">.</span><span class="n">_auto_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_save</span>
        <span class="n">new_instance</span><span class="o">.</span><span class="n">_extra_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_data</span>

        <span class="c1"># Copy circuit result data and jobs</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>  <span class="c1"># Hold the lock so no new data can be added.</span>
            <span class="n">new_instance</span><span class="o">.</span><span class="n">_result_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="o">.</span><span class="n">copy_object</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="n">fut</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
                    <span class="n">new_instance</span><span class="o">.</span><span class="n">_add_job_future</span><span class="p">(</span><span class="n">new_instance</span><span class="o">.</span><span class="n">_jobs</span><span class="p">[</span><span class="n">jid</span><span class="p">])</span>

        <span class="c1"># If not copying results return the object</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">copy_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_instance</span>

        <span class="c1"># Copy results and figures.</span>
        <span class="c1"># This requires analysis callbacks to finish</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_futures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;analysis&quot;</span><span class="p">)</span>
        <span class="n">new_instance</span><span class="o">.</span><span class="n">_analysis_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">new_instance</span><span class="o">.</span><span class="n">_figures</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
            <span class="n">new_instance</span><span class="o">.</span><span class="n">add_figures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">new_instance</span><span class="o">.</span><span class="n">_artifacts</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
            <span class="n">new_instance</span><span class="o">.</span><span class="n">add_artifacts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Recursively copy child data</span>
        <span class="n">child_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_results</span><span class="o">=</span><span class="n">copy_results</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">child_data</span><span class="p">()]</span>
        <span class="n">new_instance</span><span class="o">.</span><span class="n">_set_child_data</span><span class="p">(</span><span class="n">child_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_instance</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_child_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExperimentData</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set child experiment data for the current experiment.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">child_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_child_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;child_data_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<div class="viewcode-block" id="ExperimentData.add_tags_recursive">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_tags_recursive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_tags_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags2add</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add tags to this experiment itself and its descendants</span>

<span class="sd">        Args:</span>
<span class="sd">            tags2add - the tags that will be added to the existing tags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">+=</span> <span class="n">tags2add</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">add_tags_recursive</span><span class="p">(</span><span class="n">tags2add</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExperimentData.remove_tags_recursive">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.remove_tags_recursive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_tags_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags2remove</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove tags from this experiment itself and its descendants</span>

<span class="sd">        Args:</span>
<span class="sd">            tags2remove - the tags that will be removed from the existing tags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tags2remove</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">remove_tags_recursive</span><span class="p">(</span><span class="n">tags2remove</span><span class="p">)</span></div>


    <span class="c1"># representation and serialization</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_type</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, parent_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, tags=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_ids</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, job_ids=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_ids</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">share_level</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, share_level=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">share_level</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, metadata=&lt;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span><span class="si">}</span><span class="s2"> items&gt;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_names</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, figure_names=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_names</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notes</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, notes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">notes</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># pylint: disable=raise-missing-from</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not defined&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_safe_serialize_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return serializable object for stored jobs&quot;&quot;&quot;</span>
        <span class="c1"># Since Job objects are not serializable this removes</span>
        <span class="c1"># them from the jobs dict and returns {job_id: None}</span>
        <span class="c1"># that can be used to retrieve jobs from a service after loading</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">jobs</span><span class="p">[</span><span class="n">jid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">jobs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_safe_serialize_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return serializable object for stored figures&quot;&quot;&quot;</span>
        <span class="c1"># Convert any MPL figures into SVG images before serializing</span>
        <span class="n">figures</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">figure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
                    <span class="n">figures</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_to_svg_bytes</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">figures</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">figure</span>
        <span class="k">return</span> <span class="n">figures</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__json_encode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span>
                <span class="s2">&quot;Not all experiment jobs have finished. Jobs must be &quot;</span>
                <span class="s2">&quot;cancelled or done to serialize experiment data.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">QiskitError</span><span class="p">(</span>
                <span class="s2">&quot;Not all experiment analysis has finished. Analysis must be &quot;</span>
                <span class="s2">&quot;cancelled or done to serialize experiment data.&quot;</span>
            <span class="p">)</span>
        <span class="n">json_value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;_db_data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="p">,</span>
            <span class="s2">&quot;_analysis_results&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="p">,</span>
            <span class="s2">&quot;_analysis_callbacks&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_callbacks</span><span class="p">,</span>
            <span class="s2">&quot;_deleted_figures&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_figures</span><span class="p">,</span>
            <span class="s2">&quot;_deleted_analysis_results&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_analysis_results</span><span class="p">,</span>
            <span class="s2">&quot;_result_data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="p">,</span>
            <span class="s2">&quot;_extra_data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_data</span><span class="p">,</span>
            <span class="s2">&quot;_created_in_db&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_in_db</span><span class="p">,</span>
            <span class="s2">&quot;_figures&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_serialize_figures</span><span class="p">(),</span>  <span class="c1"># Convert figures to SVG</span>
            <span class="s2">&quot;_jobs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_serialize_jobs</span><span class="p">(),</span>  <span class="c1"># Handle non-serializable objects</span>
            <span class="s2">&quot;_artifacts&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">,</span>
            <span class="s2">&quot;_experiment&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment</span><span class="p">,</span>
            <span class="s2">&quot;_child_data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="p">,</span>
            <span class="s2">&quot;_running_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_time</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># the attribute self._service in charge of the connection and communication with the</span>
        <span class="c1">#  experiment db. It doesn&#39;t have meaning in the json format so there is no need to serialize</span>
        <span class="c1">#  it.</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_service&quot;</span><span class="p">,</span> <span class="s2">&quot;_backend&quot;</span><span class="p">]:</span>
            <span class="n">json_value</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> cannot be JSON serialized&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">json_value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__json_decode__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">att</span><span class="p">,</span> <span class="n">att_val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">att_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Not all job futures have finished.&quot;</span>
                <span class="s2">&quot; Data from running futures will not be serialized.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Not all analysis callbacks have finished.&quot;</span>
                <span class="s2">&quot; Results from running callbacks will not be serialized.&quot;</span>
            <span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Remove non-pickleable attributes</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_job_futures&quot;</span><span class="p">,</span> <span class="s2">&quot;_analysis_futures&quot;</span><span class="p">,</span> <span class="s2">&quot;_analysis_executor&quot;</span><span class="p">,</span> <span class="s2">&quot;_monitor_executor&quot;</span><span class="p">]:</span>
            <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Convert figures to SVG</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_figures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_serialize_figures</span><span class="p">()</span>

        <span class="c1"># Handle partially pickleable attributes</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_jobs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_serialize_jobs</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="c1"># Initialize non-pickled attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job_futures</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_futures</span> <span class="o">=</span> <span class="n">ThreadSafeOrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_executor</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_monitor_executor</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="mi">51</span> <span class="o">*</span> <span class="s2">&quot;-&quot;</span>
        <span class="n">n_res</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analysis_results</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">line</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Experiment: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_type</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Experiment ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">parent_id</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parent ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_data</span><span class="o">.</span><span class="n">parent_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Child Experiment Data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_child_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Backend: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tags: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_result_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis Results: </span><span class="si">{</span><span class="n">n_res</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Figures: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_figures</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Artifacts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">ret</span>

<div class="viewcode-block" id="ExperimentData.add_artifacts">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.add_artifacts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_artifacts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifacts</span><span class="p">:</span> <span class="n">ArtifactData</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">ArtifactData</span><span class="p">],</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add artifacts to experiment. The artifact ID must be unique.</span>

<span class="sd">        Args:</span>
<span class="sd">            artifacts: Artifact or list of artifacts to be added.</span>
<span class="sd">            overwrite: Whether to overwrite the existing artifact.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">artifacts</span><span class="p">,</span> <span class="n">ArtifactData</span><span class="p">):</span>
            <span class="n">artifacts</span> <span class="o">=</span> <span class="p">[</span><span class="n">artifacts</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">artifacts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">artifact</span><span class="o">.</span><span class="n">artifact_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;An artifact with id </span><span class="si">{artifact.id}</span><span class="s2"> already exists.&quot;</span>
                    <span class="s2">&quot;Set overwrite to True if you want to overwrite the existing&quot;</span>
                    <span class="s2">&quot;artifact.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">[</span><span class="n">artifact</span><span class="o">.</span><span class="n">artifact_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">artifact</span></div>


<div class="viewcode-block" id="ExperimentData.delete_artifact">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.delete_artifact">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_artifact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">artifact_key</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete specified artifact data.</span>

<span class="sd">        Args:</span>
<span class="sd">            artifact_key: UID or name of the artifact. Deleting by index is deprecated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Deleted artifact ids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">artifact_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Accessing artifacts via a numerical index is deprecated and will be &quot;</span>
                <span class="s2">&quot;removed in a future release. Use the ID or name of the artifact &quot;</span>
                <span class="s2">&quot;instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">artifact_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_artifact_keys</span><span class="p">(</span><span class="n">artifact_key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">artifact_keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleted_artifacts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">artifact_keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">artifact_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">artifact_keys</span></div>


<div class="viewcode-block" id="ExperimentData.artifacts">
<a class="viewcode-back" href="../../../stubs/qiskit_experiments.framework.ExperimentData.html#qiskit_experiments.framework.ExperimentData.artifacts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">artifacts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">artifact_key</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArtifactData</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">ArtifactData</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return specified artifact data.</span>

<span class="sd">        Args:</span>
<span class="sd">            artifact_key: UID or name of the artifact. Supplying a numerical index</span>
<span class="sd">            is deprecated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of specified artifact data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">artifact_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">artifact_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Accessing artifacts via a numerical index is deprecated and will be &quot;</span>
                <span class="s2">&quot;removed in a future release. Use the ID or name of the artifact &quot;</span>
                <span class="s2">&quot;instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">artifact_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_artifact_keys</span><span class="p">(</span><span class="n">artifact_key</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">artifact_keys</span><span class="p">:</span>
            <span class="n">artifact_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artifact_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_find_artifact_keys</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">artifact_key</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A helper method to find artifact key.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">artifact_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">artifact_key</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">artifact_key</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExperimentEntryNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Artifact index </span><span class="si">{</span><span class="n">artifact_key</span><span class="si">}</span><span class="s2"> out of range.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">artifact_key</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">artifact_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">:</span>
            <span class="n">name_matched</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artifacts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">artifact_key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_matched</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExperimentEntryNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Artifact key </span><span class="si">{</span><span class="n">artifact_key</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">name_matched</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">artifact_key</span><span class="p">]</span></div>



<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">service_exception_to_warning</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert an exception raised by experiment service to a warning.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Experiment service operation failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_series_to_service_result</span><span class="p">(</span>
    <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">service</span><span class="p">:</span> <span class="n">IBMExperimentService</span><span class="p">,</span>
    <span class="n">auto_save</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalysisResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to convert dataframe to AnalysisResult payload for IBM experiment service.</span>

<span class="sd">    .. note::</span>

<span class="sd">        Now :class:`.AnalysisResult` is only used to save data in the experiment service.</span>
<span class="sd">        All local operations must be done with :class:`.AnalysisResultTable` dataframe.</span>
<span class="sd">        ExperimentData._analysis_results are totally decoupled from</span>
<span class="sd">        the model of IBM experiment service until this function is implicitly called.</span>

<span class="sd">    Args:</span>
<span class="sd">        series: Pandas dataframe Series (a row of dataframe).</span>
<span class="sd">        service: Experiment service.</span>
<span class="sd">        auto_save: Do auto save when entry value changes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Legacy AnalysisResult payload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO This must be done on experiment service rather than by client.</span>
    <span class="n">qe_result</span> <span class="o">=</span> <span class="n">AnalysisResultData</span><span class="o">.</span><span class="n">from_table_element</span><span class="p">(</span><span class="o">**</span><span class="n">series</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

    <span class="n">result_data</span> <span class="o">=</span> <span class="n">AnalysisResult</span><span class="o">.</span><span class="n">format_result_data</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">extra</span><span class="p">,</span>
        <span class="n">chisq</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">chisq</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Overwrite formatted result data dictionary with original objects.</span>
    <span class="c1"># The format_result_data method implicitly deep copies input value and extra field,</span>
    <span class="c1"># but it means the dictionary stores input objects with different object id.</span>
    <span class="c1"># This affects computation of error propagation with ufloats, because it</span>
    <span class="c1"># recognizes the value correlation with object id.</span>
    <span class="c1"># See test.curve_analysis.test_baseclass.TestCurveAnalysis.test_end_to_end_compute_new_entry.</span>
    <span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qe_result</span><span class="o">.</span><span class="n">value</span>
    <span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;_extra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qe_result</span><span class="o">.</span><span class="n">extra</span>

    <span class="c1"># IBM Experiment Service doesn&#39;t have data field for experiment and run time.</span>
    <span class="c1"># These are added to extra field so that these data can be saved.</span>
    <span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;_extra&quot;</span><span class="p">][</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qe_result</span><span class="o">.</span><span class="n">experiment</span>
    <span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;_extra&quot;</span><span class="p">][</span><span class="s2">&quot;run_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qe_result</span><span class="o">.</span><span class="n">run_time</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="n">ResultQuality</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">qe_result</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="n">experiment_service_payload</span> <span class="o">=</span> <span class="n">AnalysisResultDataclass</span><span class="p">(</span>
        <span class="n">result_id</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">result_id</span><span class="p">,</span>
        <span class="n">experiment_id</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">,</span>
        <span class="n">result_type</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">result_data</span><span class="o">=</span><span class="n">result_data</span><span class="p">,</span>
        <span class="n">device_components</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">to_component</span><span class="p">,</span> <span class="n">qe_result</span><span class="o">.</span><span class="n">device_components</span><span class="p">)),</span>
        <span class="n">quality</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
        <span class="n">backend_name</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
        <span class="n">creation_datetime</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">created_time</span><span class="p">,</span>
        <span class="n">chisq</span><span class="o">=</span><span class="n">qe_result</span><span class="o">.</span><span class="n">chisq</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">service_result</span> <span class="o">=</span> <span class="n">AnalysisResult</span><span class="p">()</span>
    <span class="n">service_result</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">experiment_service_payload</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="n">ExperimentDataError</span><span class="p">):</span>
        <span class="n">service_result</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span>
        <span class="n">service_result</span><span class="o">.</span><span class="n">auto_save</span> <span class="o">=</span> <span class="n">auto_save</span>

    <span class="k">return</span> <span class="n">service_result</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2025, Qiskit Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 2025/06/19</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=dfb7e12a"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>